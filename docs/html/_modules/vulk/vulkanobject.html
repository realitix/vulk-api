<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vulk.vulkanobject &#8212; Vulk 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vulk.vulkanobject</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;Vulkan objects modules</span>

<span class="sd">This module contains the *High* level Vulkan object. It&#39;s not that *high*</span>
<span class="sd">level, you need to understand fully Vulkan to use theses objects.</span>
<span class="sd">This module must be use by Vulkan expert and is very complicated to work with.</span>
<span class="sd">You will see a lot of namedtuple here, they are used to better document the</span>
<span class="sd">object arguments. Instead of passing a dict whith unknow keys, you pass a</span>
<span class="sd">documented namedtuple, I think it&#39;s better.</span>
<span class="sd">If you want to understand internal Vulkan functions, you can hack around this</span>
<span class="sd">module.</span>


<span class="sd">**Note: All classes, functions, tuples of this module are sorted</span>
<span class="sd">        alphabetically.**</span>

<span class="sd">**Note: In this module, when it&#39;s needed, the parameter type is indicated. If</span>
<span class="sd">        the type begins with Vk..., it means a real Vulkan object and not an</span>
<span class="sd">        object in this module.**</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pyshaderc</span>
<span class="kn">import</span> <span class="nn">vulkan</span> <span class="k">as</span> <span class="nn">vk</span>  <span class="c1"># pylint: disable=import-error</span>

<span class="kn">from</span> <span class="nn">vulk.exception</span> <span class="k">import</span> <span class="n">VulkError</span>
<span class="kn">from</span> <span class="nn">vulk</span> <span class="k">import</span> <span class="n">vulkanconstant</span> <span class="k">as</span> <span class="n">vc</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>


<span class="c1"># ----------</span>
<span class="c1"># FUNCTIONS</span>
<span class="c1"># ----------</span>
<div class="viewcode-block" id="btov"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.btov">[docs]</a><span class="k">def</span> <span class="nf">btov</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert boolean to Vulkan boolean&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_TRUE</span> <span class="k">if</span> <span class="n">b</span> <span class="k">else</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span></div>


<div class="viewcode-block" id="find_memory_type"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.find_memory_type">[docs]</a><span class="k">def</span> <span class="nf">find_memory_type</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">type_filter</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Graphics cards can offer different types of memory to allocate from.</span>
<span class="sd">    Each type of memory varies in terms of allowed operations and performance</span>
<span class="sd">    characteristics. We need to combine the requirements of the memory and our</span>
<span class="sd">    own application requirements to find the right type of memory to use.</span>

<span class="sd">    *Parameters:*</span>

<span class="sd">    - `context`: The `VulkContext`</span>
<span class="sd">    - `type_filter`: Bit field of the memory types that are suitable</span>
<span class="sd">                     for the memory (int)</span>
<span class="sd">    - `properties`: `MemoryProperty` Vulkan constant, type of</span>
<span class="sd">                    memory we want</span>

<span class="sd">    **Todo: I made a bitwise comparaison with `type_filter`, I have to test</span>
<span class="sd">            it to be sure it&#39;s working**</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cache_properties</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceMemoryProperties</span><span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">physical_device</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">memory_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cache_properties</span><span class="o">.</span><span class="n">memoryTypes</span><span class="p">):</span>
        <span class="c1"># TODO: Test type_filter</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type_filter</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">propertyFlags</span> <span class="o">&amp;</span> <span class="n">properties</span><span class="p">)</span> <span class="o">==</span> <span class="n">properties</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t find suitable memory type&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<span class="nd">@contextmanager</span>
<div class="viewcode-block" id="immediate_buffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.immediate_buffer">[docs]</a><span class="k">def</span> <span class="nf">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandpool</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Manage creation and destruction of commandbuffer for one time submit.</span>
<span class="sd">    If commandpool is not given, it is created here.</span>

<span class="sd">    *Parameters:*</span>

<span class="sd">    - `context`: `VulkContext`</span>
<span class="sd">    - `commandpool`: `CommandPool` (optional)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">own_commandpool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">commandpool</span><span class="p">:</span>
        <span class="n">commandpool</span> <span class="o">=</span> <span class="n">CommandPool</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">],</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">CommandPoolCreate</span><span class="o">.</span><span class="n">TRANSIENT</span><span class="p">)</span>
        <span class="n">own_commandpool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">commandbuffers</span> <span class="o">=</span> <span class="n">commandpool</span><span class="o">.</span><span class="n">allocate_buffers</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferLevel</span><span class="o">.</span><span class="n">PRIMARY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferUsage</span><span class="o">.</span><span class="n">ONE_TIME_SUBMIT</span>
        <span class="k">with</span> <span class="n">commandbuffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">cmd</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSubmitInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SUBMIT_INFO</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">pWaitDstStageMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">commandBufferCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pCommandBuffers</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">commandbuffer</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">commandbuffers</span><span class="p">],</span>
            <span class="n">signalSemaphoreCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">pSignalSemaphores</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueSubmit</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">submit</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueWaitIdle</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">)</span>
        <span class="n">commandpool</span><span class="o">.</span><span class="n">free_buffers</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandbuffers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_commandpool</span><span class="p">:</span>
            <span class="n">commandpool</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>


<div class="viewcode-block" id="submit_to_graphic_queue"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.submit_to_graphic_queue">[docs]</a><span class="k">def</span> <span class="nf">submit_to_graphic_queue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">submits</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenient function to submit commands to graphic queue</span>

<span class="sd">    *Parameters:*</span>

<span class="sd">    - `context`: `VulkContext`</span>
<span class="sd">    - `submits`: `list` of `SubmitInfo`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">submit_to_queue</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">,</span> <span class="n">submits</span><span class="p">)</span></div>


<div class="viewcode-block" id="submit_to_queue"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.submit_to_queue">[docs]</a><span class="k">def</span> <span class="nf">submit_to_queue</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">submits</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Submit commands to queue</span>

<span class="sd">    *Parameters:*</span>

<span class="sd">    - `queue`: `VkQueue`</span>
<span class="sd">    - `submits`: `list` of `SubmitInfo`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vk_submits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">submits</span><span class="p">:</span>
        <span class="n">wait_stages</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">wait_stages</span><span class="p">:</span>
            <span class="n">wait_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">wait_stages</span><span class="p">]</span>

        <span class="n">wait_semaphores</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">wait_semaphores</span><span class="p">:</span>
            <span class="n">wait_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="n">sem</span><span class="o">.</span><span class="n">semaphore</span> <span class="k">for</span> <span class="n">sem</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">wait_semaphores</span><span class="p">]</span>

        <span class="n">signal_semaphores</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">signal_semaphores</span><span class="p">:</span>
            <span class="n">signal_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="n">sem</span><span class="o">.</span><span class="n">semaphore</span> <span class="k">for</span> <span class="n">sem</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">signal_semaphores</span><span class="p">]</span>

        <span class="n">vk_submits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkSubmitInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SUBMIT_INFO</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">wait_semaphores</span><span class="p">),</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="n">wait_semaphores</span><span class="p">,</span>
            <span class="n">pWaitDstStageMask</span><span class="o">=</span><span class="n">wait_stages</span><span class="p">,</span>
            <span class="n">commandBufferCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">),</span>
            <span class="n">pCommandBuffers</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">commandbuffer</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">],</span>
            <span class="n">signalSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">signal_semaphores</span><span class="p">),</span>
            <span class="n">pSignalSemaphores</span><span class="o">=</span><span class="n">signal_semaphores</span>
        <span class="p">))</span>

    <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_submits</span><span class="p">),</span> <span class="n">vk_submits</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_descriptorsets"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.update_descriptorsets">[docs]</a><span class="k">def</span> <span class="nf">update_descriptorsets</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">writes</span><span class="p">,</span> <span class="n">copies</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update the contents of a descriptor set object</span>

<span class="sd">    *Parameters:*</span>

<span class="sd">    - `context`: `VulkContext`</span>
<span class="sd">    - `writes`: `list` of `WriteDescriptorSet`</span>
<span class="sd">    - `copies`: `list` of `CopyDescriptorSet`</span>

<span class="sd">    **Todo: `copies` is unusable currently**</span>
<span class="sd">    **Todo: Only `DescriptorBufferInfo` supported**</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pImageInfo&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;pBufferInfo&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;pTexelBufferView&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">vk_descriptors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_SAMPLER</span><span class="p">,</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER</span><span class="p">,</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE</span><span class="p">,</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_STORAGE_IMAGE</span><span class="p">,</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="p">:</span>
                <span class="n">vk_descriptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorImageInfo</span><span class="p">(</span>
                    <span class="n">sampler</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">sampler</span><span class="p">,</span>
                    <span class="n">imageView</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">imageview</span><span class="p">,</span>
                    <span class="n">imageLayout</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">value</span>
                <span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pImageInfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vk_descriptors</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_UNIFORM_TEXEL_BUFFER</span><span class="p">,</span>
                   <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pTexelBufferView&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">view</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER</span><span class="p">,</span>
                   <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_STORAGE_BUFFER</span><span class="p">,</span>
                   <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMIC</span><span class="p">,</span>
                   <span class="n">vk</span><span class="o">.</span><span class="n">VK_DESCRIPTOR_TYPE_STORAGE_BUFFER_DYNAMIC</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="p">:</span>
                <span class="n">vk_descriptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorBufferInfo</span><span class="p">(</span>
                    <span class="n">buffer</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span>
                    <span class="n">offset</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                    <span class="nb">range</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">range</span>
                <span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pBufferInfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vk_descriptors</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="n">vk_writes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">writes</span><span class="p">:</span>
        <span class="n">vk_writes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkWriteDescriptorSet</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_WRITE_DESCRIPTOR_SET</span><span class="p">,</span>
            <span class="n">dstSet</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">descriptorset</span><span class="p">,</span>
            <span class="n">dstBinding</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">binding</span><span class="p">,</span>
            <span class="n">dstArrayElement</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">set_offset</span><span class="p">,</span>
            <span class="n">descriptorCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">descriptors</span><span class="p">),</span>
            <span class="n">descriptorType</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="o">**</span><span class="n">get_type</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">descriptors</span><span class="p">)</span>
        <span class="p">))</span>

    <span class="c1"># TODO: copies must be implemented</span>
    <span class="n">vk</span><span class="o">.</span><span class="n">vkUpdateDescriptorSets</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_writes</span><span class="p">),</span>
                              <span class="n">vk_writes</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">copies</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></div>


<span class="c1"># ----------</span>
<span class="c1"># NAMED TUPLES</span>
<span class="c1"># ----------</span>
<span class="n">AttachmentDescription</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;AttachmentDescription&#39;</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;stencil_load&#39;</span><span class="p">,</span> <span class="s1">&#39;stencil_store&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;initial_layout&#39;</span><span class="p">,</span> <span class="s1">&#39;final_layout&#39;</span><span class="p">])</span>
<span class="n">AttachmentDescription</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    AttachmentDescription describes the attachment.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `format`: `Format` vulk constant</span>
<span class="s1">    - `samples`: `SampleCount` vulk constant</span>
<span class="s1">    - `load`: `AttachmentLoadOp` vulk constant</span>
<span class="s1">    - `store`: `AttachmentStoreOp` vulk constant</span>
<span class="s1">    - `stencil_load`: `AttachmentLoadOp` vulk constant</span>
<span class="s1">    - `stencil_store`: `AttachmentStoreOp` vulk constant</span>
<span class="s1">    - `initial_layout`: `ImageLayout` vulk constant</span>
<span class="s1">    - `final_layout`: `ImageLayout` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">AttachmentReference</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;AttachmentReference&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;layout&#39;</span><span class="p">])</span>
<span class="n">AttachmentReference</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    AttachmentReference links an attachment index with a layout.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `index`: Index of attachment description</span>
<span class="s1">    - `layout`: `ImageLayout` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">DescriptorBufferInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;DescriptorBufferInfo&#39;</span><span class="p">,</span>
                                  <span class="p">[</span><span class="s1">&#39;buffer&#39;</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">])</span>
<span class="n">DescriptorBufferInfo</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying descriptor buffer info</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `buffer`: `Buffer` ressource</span>
<span class="s1">    - `offset`: Offset in bytes from the start of buffer</span>
<span class="s1">    - `range`: Size in bytes that is used for this descriptor update</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">DescriptorImageInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;DescriptorImageInfo&#39;</span><span class="p">,</span>
                                 <span class="p">[</span><span class="s1">&#39;sampler&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;layout&#39;</span><span class="p">])</span>
<span class="n">DescriptorImageInfo</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying descriptor image info</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `sampler`: `Sampler` ressource</span>
<span class="s1">    - `view`: `ImageView`</span>
<span class="s1">    - `layout`: `ImageLayout` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">DescriptorPoolSize</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;DescriptorPoolSize&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
<span class="n">DescriptorPoolSize</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying descriptor pool size.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `type`: `DescriptorType` vulk constant</span>
<span class="s1">    - `count`: Number of descriptors of that type to allocate</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">DescriptorSetLayoutBinding</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;DescriptorSetLayoutBinding&#39;</span><span class="p">,</span>
                                        <span class="p">[</span><span class="s1">&#39;binding&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="s1">&#39;immutable_samplers&#39;</span><span class="p">])</span>
<span class="n">DescriptorSetLayoutBinding</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying a descriptor set layout binding.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `binding`: Binding number of this entry and corresponds to a resource</span>
<span class="s1">                 of the same binding number in the shader stages</span>
<span class="s1">    - `type`: `DescriptorType` specifying which type of resource descriptors</span>
<span class="s1">              are used for this binding</span>
<span class="s1">    - `count`:  Number of descriptors contained in the binding,</span>
<span class="s1">                accessed in a shader as an array</span>
<span class="s1">    - `stage`: `ShaderStage` vulk constant specifying which pipeline shader</span>
<span class="s1">                stages can access a resource for this binding</span>
<span class="s1">    - `immutable_samplers`: Immutable `Sampler` (can be `None`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">Extent2D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Extent2D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="n">Extent2D</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `width`: Width</span>
<span class="s1">    - `height`: Height</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">Extent3D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Extent3D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">])</span>
<span class="n">Extent3D</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `width`: Width</span>
<span class="s1">    - `height`: Height</span>
<span class="s1">    - `depth`: Depth</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">ImageSubresourceRange</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ImageSubresourceRange&#39;</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="s1">&#39;base_miplevel&#39;</span><span class="p">,</span> <span class="s1">&#39;level_count&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;base_layer&#39;</span><span class="p">,</span> <span class="s1">&#39;layer_count&#39;</span><span class="p">])</span>
<span class="n">ImageSubresourceRange</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    `ImageSubresourceRange` object describes what the image&#39;s purpose is and</span>
<span class="s1">    which part of the image should be accessed.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `aspect`: `ImageAspect` vulk constant indicating which aspect(s) of the</span>
<span class="s1">                image are included in the view</span>
<span class="s1">    - `base_miplevel`: The first mipmap level accessible to the view</span>
<span class="s1">    - `level_count`: Number of mipmap levels (starting from base_miplevel)</span>
<span class="s1">                     accessible to the view</span>
<span class="s1">    - `base_layer`: First array layer accessible to the view</span>
<span class="s1">    - `layer_count`: Number of array layers (starting from base_layer)</span>
<span class="s1">                     accessible to the view</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">Offset2D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Offset2D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">Offset2D</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `x`: x offset</span>
<span class="s1">    - `y`: y offset</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineColorBlendAttachmentState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;PipelineColorBlendAttachmentState&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;enable&#39;</span><span class="p">,</span> <span class="s1">&#39;src_color&#39;</span><span class="p">,</span> <span class="s1">&#39;dst_color&#39;</span><span class="p">,</span> <span class="s1">&#39;color_op&#39;</span><span class="p">,</span>
     <span class="s1">&#39;src_alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;dst_alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_op&#39;</span><span class="p">,</span> <span class="s1">&#39;color_mask&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">PipelineColorBlendAttachmentState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `enable`: Enable blending</span>
<span class="s1">    - `src_color`: `BlendFactor` vulk constant for source color</span>
<span class="s1">    - `dst_color`: `BlendFactor` vulk constant for destination color</span>
<span class="s1">    - `color_op`: `BlendOp` vulk constant Operation on color</span>
<span class="s1">    - `src_alpha`: `BlendFactor` vulk constant for source alpha</span>
<span class="s1">    - `dst_alpha`: `BlendFactor` vulk constant for destination alpha</span>
<span class="s1">    - `alpha_op`: `BlendOp` vulk constant operation on alpha</span>
<span class="s1">    - `color_mask`: `ColorComponent` vulk constant selecting which of the</span>
<span class="s1">                    R, G, B, and A components are enabled for writing</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="n">PipelineColorBlendState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineColorBlendState&#39;</span><span class="p">,</span>
                                     <span class="p">[</span><span class="s1">&#39;op_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;op&#39;</span><span class="p">,</span> <span class="s1">&#39;attachments&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;constants&#39;</span><span class="p">])</span>
<span class="n">PipelineColorBlendState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `op_enable`: Enable bitwise combination</span>
<span class="s1">    - `op`: `LogicOp` vulk constant operation to perform</span>
<span class="s1">    - `attachments`: List of blend attachments for each framebuffer</span>
<span class="s1">    - `constants`: Constants depending on blend factor (`list` of 4 `float`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineDepthStencilState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;PipelineDepthStencilState&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;depth_test_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;depth_write_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;depth_bounds_test_enable&#39;</span><span class="p">,</span>
     <span class="s1">&#39;depth_compare&#39;</span><span class="p">,</span> <span class="s1">&#39;stencil_test_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;front&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">PipelineDepthStencilState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `depth_test_enable`: Enable depth test</span>
<span class="s1">    - `depth_write_enable`: Enable depth write</span>
<span class="s1">    - `depth_bounds_test_enable`: Enable bounds test</span>
<span class="s1">    - `depth_compare`: `CompareOp` vulk constant condition to overwrite depth</span>
<span class="s1">    - `stencil_test_enable`: Enable stencil test</span>
<span class="s1">    - `front`: Control stencil parameter (`StencilOpState`)</span>
<span class="s1">    - `back`: Control stencil parameter (`StencilOpState`)</span>
<span class="s1">    - `min`: Define the min value in depth bound test (`float`)</span>
<span class="s1">    - `max`: Define the max value in depth bound test (`float`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineDynamicState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineDynamicState&#39;</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">)</span>
<span class="n">PipelineDynamicState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    - `states`: List of `VkDynamicState`</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineInputAssemblyState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineInputAssemblyState&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;topology&#39;</span><span class="p">)</span>
<span class="n">PipelineInputAssemblyState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `topology`: `PrimitiveTopology` vulk constant to use when drawing</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineMultisampleState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineMultisampleState&#39;</span><span class="p">,</span>
                                      <span class="p">[</span><span class="s1">&#39;shading_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;min_sample_shading&#39;</span><span class="p">])</span>
<span class="n">PipelineMultisampleState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `shading_enable`: Enable multisampling (`boolean`)</span>
<span class="s1">    - `samples`: Number of samples, `SampleCount` vulk constant</span>
<span class="s1">    - `min_sample_shading`: Minimum of sample (`float`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineRasterizationState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;PipelineRasterizationState&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;depth_clamp_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;polygon_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;line_width&#39;</span><span class="p">,</span> <span class="s1">&#39;cull_mode&#39;</span><span class="p">,</span>
     <span class="s1">&#39;front_face&#39;</span><span class="p">,</span> <span class="s1">&#39;depth_bias_constant&#39;</span><span class="p">,</span> <span class="s1">&#39;depth_bias_clamp&#39;</span><span class="p">,</span>
     <span class="s1">&#39;depth_bias_slope&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">PipelineRasterizationState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `depth_clamp_enable`: Whether to enable depth clamping (`boolean`)</span>
<span class="s1">    - `polygon_mode`: Which `PolygonMode` vulk constant to use</span>
<span class="s1">    - `line_width`: Width of line (`float`)</span>
<span class="s1">    - `cull_mode`: The way of culling, `CullMode` vulk constant</span>
<span class="s1">    - `front_face`: `FrontFace` vulk constant</span>
<span class="s1">    - `depth_bias_constant`: Constant to add to depth (`float`)</span>
<span class="s1">    - `depth_bias_clamp`: Max depth bias (`float`)</span>
<span class="s1">    - `depth_bias_slope`: Factor to slope (`float`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineShaderStage</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineShaderStage&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="s1">&#39;stage&#39;</span><span class="p">])</span>
<span class="n">PipelineShaderStage</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `module`: The `ShaderModule` to bind</span>
<span class="s1">    - `stage`: `ShaderStage` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="n">PipelineVertexInputState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineVertexInputState&#39;</span><span class="p">,</span>
                                      <span class="p">[</span><span class="s1">&#39;bindings&#39;</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">])</span>
<span class="n">PipelineVertexInputState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    *Parameters:*</span>

<span class="s1">    - `bindings`: List of `VertexInputBindingDescription`</span>
<span class="s1">    - `attributes`: List of `VertexInputAttributeDescription`</span>

<span class="s1">    **Note: `bindings` and `attributes` can be empty `list`**</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">PipelineViewportState</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PipelineViewportState&#39;</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s1">&#39;viewports&#39;</span><span class="p">,</span> <span class="s1">&#39;scissors&#39;</span><span class="p">])</span>
<span class="n">PipelineViewportState</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    The PipelineViewportState object contains viewports and scissors.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `viewports`: `list` of `Viewport`</span>
<span class="s1">    - `scissors`: `list` of `Rect2D`</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">Rect2D</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Rect2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">])</span>
<span class="n">Rect2D</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    2D surface with offset.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `offset`: `Offset2D` object</span>
<span class="s1">    - `extent`: `Extent2D` object</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">SubmitInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SubmitInfo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;wait_semaphores&#39;</span><span class="p">,</span> <span class="s1">&#39;wait_stages&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;signal_semaphores&#39;</span><span class="p">,</span> <span class="s1">&#39;commandbuffers&#39;</span><span class="p">])</span>
<span class="n">SubmitInfo</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Submit information when submitting to queue</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `wait_semaphores`: `list` of `Semaphore` to wait on</span>
<span class="s1">    - `wait_stages`: `list` of `PipelineStage` vulk constant at which each</span>
<span class="s1">                     corresponding semaphore wait will occur. Must be the</span>
<span class="s1">                     same size as `wait_semaphores`</span>
<span class="s1">    - `signal_semaphores`: `list` of `Semaphore` to signal when commands</span>
<span class="s1">                           are finished</span>
<span class="s1">    - `commandbuffers`: `list` of `CommandBuffer` to execute</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">SubpassDependency</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SubpassDependency&#39;</span><span class="p">,</span>
                               <span class="p">[</span><span class="s1">&#39;src_subpass&#39;</span><span class="p">,</span> <span class="s1">&#39;src_stage&#39;</span><span class="p">,</span> <span class="s1">&#39;src_access&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;dst_subpass&#39;</span><span class="p">,</span> <span class="s1">&#39;dst_stage&#39;</span><span class="p">,</span> <span class="s1">&#39;dst_access&#39;</span><span class="p">])</span>
<span class="n">SubpassDependency</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SubpassDependency describes all dependencies of the subpass.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `src_subpass`: Source subpass `int` or `SUBPASS_EXTERNAL` vulk constant</span>
<span class="s1">    - `src_stage`: Source stage `PipelineStage` vulk constant</span>
<span class="s1">    - `src_access`: Source `Access` vulk constant</span>
<span class="s1">    - `dst_subpass`: Destination subpass `int` or</span>
<span class="s1">                     `SUBPASS_EXTERNAL` vulk constant</span>
<span class="s1">    - `dst_stage`: Destination stage `PipelineStage` vulk constant</span>
<span class="s1">    - `dst_access`: Destination `Access` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">SubpassDescription</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SubpassDescription&#39;</span><span class="p">,</span>
                                <span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;resolves&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;preserves&#39;</span><span class="p">,</span> <span class="s1">&#39;depth_stencil&#39;</span><span class="p">])</span>
<span class="n">SubpassDescription</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    `SubpassDescription` describes all attachments in the subpass.</span>
<span class="s1">    All parameters are of type `AttachmentReference`. If you don&#39;t want</span>
<span class="s1">    an attachment, set it to an empty list.</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `colors`: `list` of colors attachments</span>
<span class="s1">    - `inputs`: `list` of inputs attachments</span>
<span class="s1">    - `resolves`: `list` of resolves attachments (must be the same</span>
<span class="s1">                  size as inputs)</span>
<span class="s1">    - `preserves`: `list` of preserves attachments</span>
<span class="s1">    - `depth_stencil`: `list` containing only one attachment</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">VertexInputAttributeDescription</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;VertexInputAttributeDescription&#39;</span><span class="p">,</span>
                                             <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;binding&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;offset&#39;</span><span class="p">])</span>
<span class="n">VertexInputAttributeDescription</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">     Structure specifying vertex input attribute description</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `location`: Shader binding location number for this attribute (`int`)</span>
<span class="s1">    - `binding`: Binding number which this attribute takes its data from</span>
<span class="s1">    - `format`: `Format` vulk constant of the vertex attribute data</span>
<span class="s1">    - `offset`: Byte offset of this attribute relative to the start of an</span>
<span class="s1">                element in the vertex input binding (`int`)</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">VertexInputBindingDescription</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;VertexInputBindingDescription&#39;</span><span class="p">,</span>
                                           <span class="p">[</span><span class="s1">&#39;binding&#39;</span><span class="p">,</span> <span class="s1">&#39;stride&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">])</span>
<span class="n">VertexInputBindingDescription</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying vertex input binding description</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `binding`: Binding number (`int`)</span>
<span class="s1">    - `stride`: Distance in bytes between two consecutive elements within</span>
<span class="s1">                the buffer (`int`)</span>
<span class="s1">    - `rate`: `VertexInputRate` vulk constant</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="n">Viewport</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Viewport&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;min_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
<span class="n">Viewport</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying a viewport</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `x`: X upper left corner</span>
<span class="s1">    - `y`: Y upper left corner</span>
<span class="s1">    - `width`: Viewport width</span>
<span class="s1">    - `height`: Viewport height</span>
<span class="s1">    - `min_depth`: Depth range for the viewport</span>
<span class="s1">    - `max_depth`: Depth range for the viewport</span>

<span class="s1">    **Note: `min_depth` and `max_depth` must be between 0.0 and 1.0**</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="n">WriteDescriptorSet</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;WriteDescriptorSet&#39;</span><span class="p">,</span>
                                <span class="p">[</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;binding&#39;</span><span class="p">,</span> <span class="s1">&#39;set_offset&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;descriptors&#39;</span><span class="p">])</span>
<span class="n">WriteDescriptorSet</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Structure specifying the parameters of a descriptor set write operation</span>

<span class="s1">    *Parameters:*</span>

<span class="s1">    - `set`: Destination `DescriptorSet` set to update</span>
<span class="s1">    - `binding`: Descriptor binding within that set</span>
<span class="s1">    - `set_offset`: Offset to start with in the descriptor</span>
<span class="s1">    - `type`: Type of descriptor `DescriptorType` vulk constant</span>
<span class="s1">    - `descriptors`: `list` of `DescriptorBufferInfo` or `DescriptorImageInfo`</span>
<span class="s1">                    or `BufferView` depending on `type`</span>

<span class="s1">    **Note: The descriptor type must correspond to the `type` parameter**</span>
<span class="s1">    &#39;&#39;&#39;</span>


<span class="c1"># ----------</span>
<span class="c1"># CLASSES</span>
<span class="c1"># ----------</span>
<div class="viewcode-block" id="Buffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Buffer">[docs]</a><span class="k">class</span> <span class="nc">Buffer</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `Buffer` wrap a `VkBuffer` and a `VkMemory`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">sharing_mode</span><span class="p">,</span>
                 <span class="n">queue_families</span><span class="p">,</span> <span class="n">memory_properties</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a new buffer</span>

<span class="sd">        Creating a buffer is made of several steps:</span>

<span class="sd">        - Create the buffer</span>
<span class="sd">        - Allocate the memory</span>
<span class="sd">        - Bind the memory to the buffer</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `flags`: `BufferCreate` vulk constant</span>
<span class="sd">        - `size`: Buffer size in bytes</span>
<span class="sd">        - `usage`: `BufferUsage` vulk constant</span>
<span class="sd">        - `sharing_mode`: `SharingMode` vulk constant</span>
<span class="sd">        - `queue_families`: List of queue families accessing this image</span>
<span class="sd">                            (ignored if sharingMode is not</span>
<span class="sd">                            `CONCURRENT`) (can be [])</span>
<span class="sd">        - `memory_properties`: `MemoryProperty` vulk constant</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span> <span class="o">=</span> <span class="n">memory_properties</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>

        <span class="c1"># Create VkBuffer</span>
        <span class="n">buffer_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkBufferCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">sharingMode</span><span class="o">=</span><span class="n">sharing_mode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">queueFamilyIndexCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">queue_families</span><span class="p">),</span>
            <span class="n">pQueueFamilyIndices</span><span class="o">=</span><span class="n">queue_families</span> <span class="k">if</span> <span class="n">queue_families</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateBuffer</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">buffer_create</span><span class="p">)</span>

        <span class="c1"># Get memory requirements</span>
        <span class="n">requirements</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetBufferMemoryRequirements</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>

        <span class="n">alloc_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkMemoryAllocateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO</span><span class="p">,</span>
            <span class="n">allocationSize</span><span class="o">=</span><span class="n">requirements</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="n">memoryTypeIndex</span><span class="o">=</span><span class="n">find_memory_type</span><span class="p">(</span>
                <span class="n">context</span><span class="p">,</span>
                <span class="n">requirements</span><span class="o">.</span><span class="n">memoryTypeBits</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Create memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkAllocateMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">alloc_info</span><span class="p">)</span>

        <span class="c1"># Bind device memory to the buffer</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkBindBufferMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="Buffer.copy_to"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Buffer.copy_to">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">dst_buffer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy this buffer to the destination buffer.</span>
<span class="sd">        Commands to copy are registered in the commandbuffer but it&#39;s up to</span>
<span class="sd">        you to start and submit the command buffer to the execution queue.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `cmd`: `CommandBufferRegister` used to register commands</span>
<span class="sd">        - `dst_buffer`: Destination `Buffer`</span>

<span class="sd">        **Note: Buffers must have the same size**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">dst_buffer</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Buffers must have the same size&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">region</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkBufferCopy</span><span class="p">(</span>
            <span class="n">srcOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">dstOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="p">)</span>

        <span class="n">cmd</span><span class="o">.</span><span class="n">copy_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dst_buffer</span><span class="p">,</span> <span class="p">[</span><span class="n">region</span><span class="p">])</span></div>

    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="Buffer.bind"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Buffer.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Map this buffer to upload data in it.</span>
<span class="sd">        This function is a context manager and must be called with `with`.</span>
<span class="sd">        It return a python buffer and let you do what you want with it,</span>
<span class="sd">        be careful!</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>

<span class="sd">        **Warning: Buffer memory must be host visible**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">compatible_memories</span> <span class="o">=</span> <span class="p">{</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</span><span class="p">,</span>
                               <span class="n">vk</span><span class="o">.</span><span class="n">VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</span><span class="p">,</span>
                               <span class="n">vk</span><span class="o">.</span><span class="n">VK_MEMORY_PROPERTY_HOST_CACHED_BIT</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span> <span class="o">&amp;</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">compatible_memories</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t map this buffer, memory must be host visible&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkMapMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">data</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">vkUnmapMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ClearColorValue"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ClearColorValue">[docs]</a><span class="k">class</span> <span class="nc">ClearColorValue</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;ClearValue for color clearing&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float32</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uint32</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">int32</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Take only one value depending on the type you want.</span>
<span class="sd">        `list` must be of size 4.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `float32`: Type `float`</span>
<span class="sd">        - `uint32`: Type `uint`</span>
<span class="sd">        - `int32`: Type `int`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">float32</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">int32</span><span class="p">)</span>

        <span class="c1"># Set to list</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">v</span>

        <span class="c1"># Check that only one value is set</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span> <span class="k">if</span> <span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Only one value in [float32, uint32, int32] must be given&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check size of value (must be 4)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t</span> <span class="k">if</span> <span class="n">t</span><span class="p">])))</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Value must be a list of 4 elements&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">float32</span><span class="p">:</span>
            <span class="n">clear</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkClearColorValue</span><span class="p">(</span><span class="n">float32</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uint32</span><span class="p">:</span>
            <span class="n">clear</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkClearColorValue</span><span class="p">(</span><span class="n">uint32</span><span class="o">=</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">int32</span><span class="p">:</span>
            <span class="n">clear</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkClearColorValue</span><span class="p">(</span><span class="n">int32</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span> <span class="o">=</span> <span class="n">clear</span></div>


<div class="viewcode-block" id="ClearDepthStencilValue"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ClearDepthStencilValue">[docs]</a><span class="k">class</span> <span class="nc">ClearDepthStencilValue</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;ClearValue for depth and stencil clearing&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">stencil</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `depth`: Value in [0.0, 1.0]</span>
<span class="sd">        - `stencil`; `int` value</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkClearDepthStencilValue</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">stencil</span><span class="o">=</span><span class="n">stencil</span><span class="p">)</span></div>


<div class="viewcode-block" id="CommandBuffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBuffer">[docs]</a><span class="k">class</span> <span class="nc">CommandBuffer</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Commands in Vulkan, like drawing operations and memory transfers, are not</span>
<span class="sd">    executed directly using function calls. You have to record all of the</span>
<span class="sd">    operations you want to perform in command buffer objects. The advantage of</span>
<span class="sd">    this is that all of the hard work of setting up the drawing commands can</span>
<span class="sd">    be done in advance and in multiple threads. After that, you just have to</span>
<span class="sd">    tell Vulkan to execute the commands in the main loop.</span>

<span class="sd">    Commands are executed directly from the `CommandBufferRegister` subclass.</span>
<span class="sd">    The naming convention is simple:</span>
<span class="sd">    `vkCmd[CommandName]` becomes `command_name`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandbuffer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This object must be initialized with an existing `VkCommandBuffer`</span>
<span class="sd">        because it is generated from `CommandPool`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `commandbuffer`: `VkCommandBuffer`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span> <span class="o">=</span> <span class="n">commandbuffer</span>

<div class="viewcode-block" id="CommandBuffer.reset"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBuffer.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferReset</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reset the command buffer</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `flags`: `CommandBufferReset` vulk constant, default to 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkResetCommandBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span></div>

    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="CommandBuffer.bind"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBuffer.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferUsage</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Bind this buffer to register command.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `flags`: `CommandBufferUsage` vulk constant, default to 0</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        `CommandBufferRegister` object</span>

<span class="sd">        **Todo: `pInheritanceInfo` must be implemented**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">commandbuffer_begin_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkCommandBufferBeginInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">pInheritanceInfo</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">vkBeginCommandBuffer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span>
                <span class="n">commandbuffer_begin_create</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">CommandBufferRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">vkEndCommandBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CommandBufferRegister"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister">[docs]</a><span class="k">class</span> <span class="nc">CommandBufferRegister</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Allow to call command on command buffer.</span>
<span class="sd">    `CommandBufferRegister` is not in charge of begin and end the command</span>
<span class="sd">    buffer. You should not use it directly but with `bind` method of</span>
<span class="sd">    `CommandBuffer`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandbuffer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `commandbuffer`: The `VkCommandBuffer`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span> <span class="o">=</span> <span class="n">commandbuffer</span>

<div class="viewcode-block" id="CommandBufferRegister.begin_renderpass"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.begin_renderpass">[docs]</a>    <span class="k">def</span> <span class="nf">begin_renderpass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderpass</span><span class="p">,</span> <span class="n">framebuffer</span><span class="p">,</span> <span class="n">renderarea</span><span class="p">,</span>
                         <span class="n">clears</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">SubpassContents</span><span class="o">.</span><span class="n">INLINE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Begin a new renderpass</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `renderpass`: The `RenderPass` to begin an instance of</span>
<span class="sd">        - `framebuffer`: The `Framebuffer` containing the attachments that</span>
<span class="sd">                         are used with the render pass</span>
<span class="sd">        - `renderarea`: `Rect2D` size to render</span>
<span class="sd">        - `clears`:  `list` of `ClearValue` for each `Framebuffer`</span>
<span class="sd">        - `contents`: `SubpassContents` vulk constant (default: `INLINE`)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_renderarea</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkRect2D</span><span class="p">(</span>
            <span class="n">offset</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkOffset2D</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">renderarea</span><span class="o">.</span><span class="n">offset</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">renderarea</span><span class="o">.</span><span class="n">offset</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkExtent2D</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="n">renderarea</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">renderarea</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">vk_clearvalues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clears</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ClearColorValue</span><span class="p">):</span>
                <span class="n">vk_clearvalues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkClearValue</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">clear</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ClearDepthStencilValue</span><span class="p">):</span>
                <span class="n">vk_clearvalues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkClearValue</span><span class="p">(</span><span class="n">depthStencil</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">clear</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown clear value&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">renderpass_begin</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkRenderPassBeginInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_RENDER_PASS_BEGIN_INFO</span><span class="p">,</span>
            <span class="n">renderPass</span><span class="o">=</span><span class="n">renderpass</span><span class="o">.</span><span class="n">renderpass</span><span class="p">,</span>
            <span class="n">framebuffer</span><span class="o">=</span><span class="n">framebuffer</span><span class="o">.</span><span class="n">framebuffer</span><span class="p">,</span>
            <span class="n">renderArea</span><span class="o">=</span><span class="n">vk_renderarea</span><span class="p">,</span>
            <span class="n">clearValueCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_clearvalues</span><span class="p">),</span>
            <span class="n">pClearValues</span><span class="o">=</span><span class="n">vk_clearvalues</span>
        <span class="p">)</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdBeginRenderPass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">renderpass_begin</span><span class="p">,</span>
                                <span class="n">contents</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.bind_descriptor_sets"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.bind_descriptor_sets">[docs]</a>    <span class="k">def</span> <span class="nf">bind_descriptor_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span>
                             <span class="n">bind_point</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineBindPoint</span><span class="o">.</span><span class="n">GRAPHICS</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Binds descriptor sets to this `CommandBuffer`</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `layout`: `PipelineLayout`</span>
<span class="sd">        - `first`: Number of the first descriptor set to be bound</span>
<span class="sd">        - `descriptors`: `list` of `DescriptorSet`</span>
<span class="sd">        - `offsets`: `list` of dynamic offsets</span>
<span class="sd">        - `bind_point`: `PipelineBindPoint` vulk constant (default: GRAPHICS)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_descriptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">descriptorset</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="p">]</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdBindDescriptorSets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">bind_point</span><span class="p">,</span> <span class="n">layout</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">vk_descriptors</span><span class="p">),</span> <span class="n">vk_descriptors</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">),</span>
            <span class="n">offsets</span> <span class="k">if</span> <span class="n">offsets</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.bind_pipeline"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.bind_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">bind_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span>
                      <span class="n">bind_point</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineBindPoint</span><span class="o">.</span><span class="n">GRAPHICS</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Bind the pipeline to this `CommandBuffer`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `pipeline`: The `Pipeline` to bind</span>
<span class="sd">        - `bind_point`: `PipelineBindPoint` vulk constant (default: GRAPHICS)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdBindPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">bind_point</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.bind_vertex_buffers"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.bind_vertex_buffers">[docs]</a>    <span class="k">def</span> <span class="nf">bind_vertex_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">buffers</span><span class="p">,</span> <span class="n">offsets</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Bind vertex buffers to a command buffer</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `first`: Index of the first vertex input binding</span>
<span class="sd">        - `count`: Number of vertex input bindings</span>
<span class="sd">        - `buffers`: `list` of `Buffer`</span>
<span class="sd">        - `offsets`: `list` of offset (`int`)</span>

<span class="sd">        **Note: I don&#39;t understand what is the point with offset but you</span>
<span class="sd">                must pass an array of the same size as `buffers`.**</span>

<span class="sd">        **Note: Generally, `count = len(buffers)` and `first = 0`**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdBindVertexBuffers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span>
                                  <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">buffer</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buffers</span><span class="p">],</span> <span class="n">offsets</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.bind_index_buffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.bind_index_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">bind_index_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">index_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Bind an index buffer to a command buffer</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `buffer`: Index `Buffer`</span>
<span class="sd">        - `offset`: Offset (`int`)</span>
<span class="sd">        - `index_type`: `IndexType` vulk constant</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdBindIndexBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">buffer</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span>
                                <span class="n">index_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.clear_color_image"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.clear_color_image">[docs]</a>    <span class="k">def</span> <span class="nf">clear_color_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">clear_color</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clear image with color values</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `image`: `Image` to clear</span>
<span class="sd">        - `layout`: `ImageLayout` of `image`</span>
<span class="sd">        - `clear_color`: `ClearColorValue`</span>
<span class="sd">        - `ranges`: `list` of `ImageSubresourceRange`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
            <span class="n">vk_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkImageSubresourceRange</span><span class="p">(</span>
                <span class="n">aspectMask</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">aspect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">baseMipLevel</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">base_miplevel</span><span class="p">,</span>
                <span class="n">levelCount</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">level_count</span><span class="p">,</span>
                <span class="n">baseArrayLayer</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">base_layer</span><span class="p">,</span>
                <span class="n">layerCount</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">layer_count</span>
            <span class="p">))</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdClearColorImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span>
                                <span class="n">clear_color</span><span class="o">.</span><span class="n">clear</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_ranges</span><span class="p">),</span> <span class="n">vk_ranges</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.draw"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex_count</span><span class="p">,</span> <span class="n">first_vertex</span><span class="p">,</span>
             <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">first_instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Draw the vertice buffer.</span>

<span class="sd">        When the command is executed, primitives are assembled using the</span>
<span class="sd">        current primitive topology and vertexCount consecutive vertex</span>
<span class="sd">        indices with the first vertexIndex value equal to firstVertex.</span>
<span class="sd">        The primitives are drawn instanceCount times with instanceIndex</span>
<span class="sd">        starting with firstInstance and increasing sequentially for each</span>
<span class="sd">        instance. The assembled primitives execute the currently bound</span>
<span class="sd">        graphics pipeline.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `vertex_count`: Number of vertices to draw</span>
<span class="sd">        - `first_vertex`: Index of the first vertex to draw</span>
<span class="sd">        - `instance_count`: Number of instance to draw (default: 1)</span>
<span class="sd">        - `first_instance`: First instance to draw (default: 0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdDraw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">vertex_count</span><span class="p">,</span> <span class="n">instance_count</span><span class="p">,</span>
                     <span class="n">first_vertex</span><span class="p">,</span> <span class="n">first_instance</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.draw_indexed"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.draw_indexed">[docs]</a>    <span class="k">def</span> <span class="nf">draw_indexed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">first_index</span><span class="p">,</span> <span class="n">vertex_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">first_instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Draw the index buffer.</span>

<span class="sd">        When the command is executed, primitives are assembled using the</span>
<span class="sd">        current primitive topology and indexCount vertices whose indices are</span>
<span class="sd">        retrieved from the index buffer. The index buffer is treated as an</span>
<span class="sd">        array of tightly packed unsigned integers of size defined by the</span>
<span class="sd">        vkCmdBindIndexBuffer::indexType parameter with which the buffer</span>
<span class="sd">        was bound.</span>

<span class="sd">        The first vertex index is at an offset of</span>
<span class="sd">        firstIndex * indexSize + offset within the currently bound index</span>
<span class="sd">        buffer, where offset is the offset specified by vkCmdBindIndexBuffer</span>
<span class="sd">        and indexSize is the byte size of the type specified by indexType.</span>
<span class="sd">        Subsequent index values are retrieved from consecutive locations in</span>
<span class="sd">        the index buffer. Indices are first compared to the primitive restart</span>
<span class="sd">        value, then zero extended to 32 bits</span>
<span class="sd">        (if the indexType is VK_INDEX_TYPE_UINT16) and have vertexOffset added</span>
<span class="sd">        to them, before being supplied as the vertexIndex value.</span>

<span class="sd">        The primitives are drawn instanceCount times with instanceIndex</span>
<span class="sd">        starting with firstInstance and increasing sequentially for each</span>
<span class="sd">        instance. The assembled primitives execute the currently bound</span>
<span class="sd">        graphics pipeline.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `index_count`: Number of vertices to draw</span>
<span class="sd">        - `first_index`: Base index within the index buffer</span>
<span class="sd">        - `vertex_offset`: Value added to the vertex index before indexing</span>
<span class="sd">                           into the vertex buffer (default: 0)</span>
<span class="sd">        - `instance_count`: Number of instance to draw (default: 1)</span>
<span class="sd">        - `first_instance`: First instance to draw (default: 0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdDrawIndexed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">instance_count</span><span class="p">,</span>
                            <span class="n">first_index</span><span class="p">,</span> <span class="n">vertex_offset</span><span class="p">,</span> <span class="n">first_instance</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.pipeline_barrier"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.pipeline_barrier">[docs]</a>    <span class="k">def</span> <span class="nf">pipeline_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_stage</span><span class="p">,</span> <span class="n">dst_stage</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">memories</span><span class="p">,</span>
                         <span class="n">buffers</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Insert a memory dependency</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `src_stage`: `PipelineStage` vulk constant</span>
<span class="sd">        - `dst_stage`: `PipelineStage` vulk constant</span>
<span class="sd">        - `dependency`: `Dependency` vulk constant</span>
<span class="sd">        - `memories`: `list` of `VkMemoryBarrier` Vulkan objects</span>
<span class="sd">        - `buffers`: `list` of `VkBufferMemoryBarrier` Vulkan objects</span>
<span class="sd">        - `images`: `list` of `VkImageMemoryBarrier` Vulkan objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_memories</span> <span class="o">=</span> <span class="n">memories</span> <span class="k">if</span> <span class="n">memories</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">vk_buffers</span> <span class="o">=</span> <span class="n">buffers</span> <span class="k">if</span> <span class="n">buffers</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">vk_images</span> <span class="o">=</span> <span class="n">images</span> <span class="k">if</span> <span class="n">images</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdPipelineBarrier</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">src_stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dst_stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">dependency</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">memories</span><span class="p">),</span> <span class="n">vk_memories</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffers</span><span class="p">),</span>
            <span class="n">vk_buffers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">),</span> <span class="n">vk_images</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.copy_image"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.copy_image">[docs]</a>    <span class="k">def</span> <span class="nf">copy_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_image</span><span class="p">,</span> <span class="n">src_layout</span><span class="p">,</span> <span class="n">dst_image</span><span class="p">,</span>
                   <span class="n">dst_layout</span><span class="p">,</span> <span class="n">regions</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy data between images</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `src_image`: `Image`</span>
<span class="sd">        - `src_layout`: `ImageLayout` vulk constant</span>
<span class="sd">        - `dst_image`: `Image`</span>
<span class="sd">        - `dst_layout`: `ImageLayout` vulk constant</span>
<span class="sd">        - `regions`: `list` of `VkImageCopy`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdCopyImage</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">src_image</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">src_layout</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">dst_image</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">dst_layout</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">),</span> <span class="n">regions</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.copy_buffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.copy_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">copy_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_buffer</span><span class="p">,</span> <span class="n">dst_buffer</span><span class="p">,</span> <span class="n">regions</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy data between buffers</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `src_buffer`: `Buffer`</span>
<span class="sd">        - `dst_buffer`: `Buffer`</span>
<span class="sd">        - `regions`: `list` of `VkBufferCopy`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdCopyBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">,</span> <span class="n">src_buffer</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span>
                           <span class="n">dst_buffer</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">),</span> <span class="n">regions</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandBufferRegister.end_renderpass"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandBufferRegister.end_renderpass">[docs]</a>    <span class="k">def</span> <span class="nf">end_renderpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;End the current render pass&#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkCmdEndRenderPass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CommandPool"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandPool">[docs]</a><span class="k">class</span> <span class="nc">CommandPool</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Command pools manage the memory that is used to store the buffers and</span>
<span class="sd">    command buffers are allocated from them.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">queue_family_index</span><span class="p">,</span>
                 <span class="n">flags</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">CommandPoolCreate</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `queue_family_index`: Index of the queue family to use</span>
<span class="sd">        - `flags`: `CommandPoolCreate` vulk constant, default to 0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">commandpool_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkCommandPoolCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO</span><span class="p">,</span>
            <span class="n">queueFamilyIndex</span><span class="o">=</span><span class="n">queue_family_index</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

        <span class="c1"># The Vulkan command pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandpool</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateCommandPool</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                  <span class="n">commandpool_create</span><span class="p">)</span>
        <span class="c1"># Command buffers allocated from this pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="CommandPool.allocate_buffers"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandPool.allocate_buffers">[docs]</a>    <span class="k">def</span> <span class="nf">allocate_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Allocate `list` of `CommandBuffer` from pool.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `level`: `CommandBufferLevel` vulk constant</span>
<span class="sd">        - `count`: Number of `CommandBuffer` to create</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        `list` of `CommandBuffer`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">commandbuffers_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkCommandBufferAllocateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO</span><span class="p">,</span>
            <span class="n">commandPool</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commandpool</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">commandBufferCount</span><span class="o">=</span><span class="n">count</span>
        <span class="p">)</span>

        <span class="n">vk_commandbuffers</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkAllocateCommandBuffers</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
            <span class="n">commandbuffers_create</span><span class="p">)</span>

        <span class="n">commandbuffers</span> <span class="o">=</span> <span class="p">[</span><span class="n">CommandBuffer</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">vk_commandbuffers</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">commandbuffers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">commandbuffers</span></div>

<div class="viewcode-block" id="CommandPool.free_buffers"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandPool.free_buffers">[docs]</a>    <span class="k">def</span> <span class="nf">free_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">buffers</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Free list of `CommandBuffer` allocated from this pool.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `buffers`: `list` of `CommandBuffer` to free</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buffers</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t free a commandbuffer not allocated by this pool&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkFreeCommandBuffers</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandpool</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffers</span><span class="p">),</span>
            <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">commandbuffer</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buffers</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CommandPool.free"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.CommandPool.free">[docs]</a>    <span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Free this command pool</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkDestroyCommandPool</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandpool</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DescriptorPool"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.DescriptorPool">[docs]</a><span class="k">class</span> <span class="nc">DescriptorPool</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A descriptor pool maintains a pool of descriptors, from which descriptor</span>
<span class="sd">    sets are allocated. Descriptor pools are externally synchronized, meaning</span>
<span class="sd">    that the application must not allocate and/or free descriptor sets from</span>
<span class="sd">    the same pool in multiple threads simultaneously.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">poolsizes</span><span class="p">,</span> <span class="n">max_sets</span><span class="p">,</span>
                 <span class="n">flags</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">DescriptorPoolCreate</span><span class="o">.</span><span class="n">NONE</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `poolsizes`: `list` of `PoolSize`</span>
<span class="sd">        - `max_sets`: Maximum number of descriptor sets that can be</span>
<span class="sd">                      allocated from the pool</span>
<span class="sd">        - `flags`: `DescriptorPoolCreate`  vulk constant (default=0)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_poolsizes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poolsizes</span><span class="p">:</span>
            <span class="n">vk_poolsizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorPoolSize</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">descriptorCount</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">count</span>
            <span class="p">))</span>

        <span class="n">descriptorpool_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorPoolCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DESCRIPTOR_POOL_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">maxSets</span><span class="o">=</span><span class="n">max_sets</span><span class="p">,</span>
            <span class="n">poolSizeCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_poolsizes</span><span class="p">),</span>
            <span class="n">pPoolSizes</span><span class="o">=</span><span class="n">vk_poolsizes</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorpool</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateDescriptorPool</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">descriptorpool_create</span><span class="p">)</span>

<div class="viewcode-block" id="DescriptorPool.allocate_descriptorsets"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.DescriptorPool.allocate_descriptorsets">[docs]</a>    <span class="k">def</span> <span class="nf">allocate_descriptorsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">layouts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Allocate `list` of `DescriptorSet` from pool.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `count`: Number of `DescriptorSet` to create</span>
<span class="sd">        - `layouts`: `list` of `DescriptorSetLayout`</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        `list` of `DescriptorSet`</span>

<span class="sd">        **Note: Size of `layouts` list must be equals to `count`**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">descriptorsets_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorSetAllocateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DESCRIPTOR_SET_ALLOCATE_INFO</span><span class="p">,</span>
            <span class="n">descriptorPool</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptorpool</span><span class="p">,</span>
            <span class="n">descriptorSetCount</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
            <span class="n">pSetLayouts</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">descriptorsetlayout</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">layouts</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">vk_descriptorsets</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkAllocateDescriptorSets</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">descriptorsets_create</span><span class="p">)</span>

        <span class="n">descriptorsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">DescriptorSet</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">vk_descriptorsets</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">descriptorsets</span></div></div>


<div class="viewcode-block" id="DescriptorSet"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.DescriptorSet">[docs]</a><span class="k">class</span> <span class="nc">DescriptorSet</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A *descriptor set* specifies the actual buffer or image resources that</span>
<span class="sd">    will be bound to the descriptors, just like a framebuffer specifies the</span>
<span class="sd">    actual image views to bind to render pass attachments. The descriptor set</span>
<span class="sd">    is then bound for the drawing commands just like the vertex buffers</span>
<span class="sd">    and framebuffer.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptorset</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This object must be initialized with an existing `VkDescriptorSet`</span>
<span class="sd">        because it is generated from `DescriptorPool`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `descriptorset`: `VkDescriptorSet`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorset</span> <span class="o">=</span> <span class="n">descriptorset</span></div>


<div class="viewcode-block" id="DescriptorSetLayout"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.DescriptorSetLayout">[docs]</a><span class="k">class</span> <span class="nc">DescriptorSetLayout</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A descriptor set layout object is defined by an array of zero or more</span>
<span class="sd">    descriptor bindings. Each individual descriptor binding is specified by</span>
<span class="sd">    a descriptor type, a count (array size) of the number of descriptors in</span>
<span class="sd">    the binding, a set of shader stages that can access the binding,</span>
<span class="sd">    and (if using immutable samplers) an array of sampler descriptors.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">bindings</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `bindings`: `list` of `DescriptorSetLayoutBinding`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_bindings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
            <span class="n">vk_bindings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorSetLayoutBinding</span><span class="p">(</span>
                <span class="n">binding</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">binding</span><span class="p">,</span>
                <span class="n">descriptorType</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">descriptorCount</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                <span class="n">stageFlags</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">pImmutableSamplers</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">immutable_samplers</span>
            <span class="p">))</span>

        <span class="n">layout_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDescriptorSetLayoutCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DESCRIPTOR_SET_LAYOUT_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">bindingCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_bindings</span><span class="p">),</span>
            <span class="n">pBindings</span><span class="o">=</span><span class="n">vk_bindings</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">descriptorsetlayout</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateDescriptorSetLayout</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">layout_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framebuffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Framebuffer">[docs]</a><span class="k">class</span> <span class="nc">Framebuffer</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    In Vulkan, a `Framebuffer` references all of the `VkImageView` objects that</span>
<span class="sd">    represent the attachments of a `Renderpass`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">renderpass</span><span class="p">,</span> <span class="n">attachments</span><span class="p">,</span>
                 <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `renderpass`: The compatible `Renderpass` of this `Framebuffer`</span>
<span class="sd">        - `attachments`: List of `ImageView`</span>
<span class="sd">        - `width`: Width (`int`)</span>
<span class="sd">        - `height`: Height (`int`)</span>
<span class="sd">        - `layers`: Number of layers (`int`)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">framebuffer_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkFramebufferCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_FRAMEBUFFER_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">renderPass</span><span class="o">=</span><span class="n">renderpass</span><span class="o">.</span><span class="n">renderpass</span><span class="p">,</span>
            <span class="n">attachmentCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">attachments</span><span class="p">),</span>
            <span class="n">pAttachments</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">imageview</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">layers</span><span class="o">=</span><span class="n">layers</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">framebuffer</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateFramebuffer</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                  <span class="n">framebuffer_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="HighPerformanceBuffer"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.HighPerformanceBuffer">[docs]</a><span class="k">class</span> <span class="nc">HighPerformanceBuffer</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `HighPerformanceBuffer` allows to use high performance buffer to be</span>
<span class="sd">    accessed in your vertex stage.</span>

<span class="sd">    To get the maximum performance, we are going to create two `Buffer`,</span>
<span class="sd">    a staging buffer which memory can be updated and a final buffer with</span>
<span class="sd">    very fast memory that we will use in pipeline.</span>
<span class="sd">    When we create a buffer, we first upload data in the staging buffer</span>
<span class="sd">    and then copy the memory in the final buffer. Of course, both of the</span>
<span class="sd">    buffer have the same properties.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span>
                 <span class="n">sharing_mode</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">SharingMode</span><span class="o">.</span><span class="n">EXCLUSIVE</span><span class="p">,</span>
                 <span class="n">queue_families</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a high performance buffer</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `size`: Buffer size in bytes</span>
<span class="sd">        - `usage`: `BufferUsage` vulk constant</span>
<span class="sd">        - &#39;buffer_type&#39;: `str` in [&#39;index&#39;, &#39;uniform&#39;, &#39;vertex&#39;]</span>
<span class="sd">        - `sharing_mode`: `SharingMode` vulk constant</span>
<span class="sd">        - `queue_families`: List of queue families accessing this image</span>
<span class="sd">                            (ignored if sharingMode is not CONCURRENT)</span>
<span class="sd">                            (can be [])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">queue_families</span> <span class="o">=</span> <span class="n">queue_families</span> <span class="k">if</span> <span class="n">queue_families</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">staging_buffer</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">BufferCreate</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">BufferUsage</span><span class="o">.</span><span class="n">TRANSFER_SRC</span><span class="p">,</span>
            <span class="n">sharing_mode</span><span class="p">,</span> <span class="n">queue_families</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_VISIBLE</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_COHERENT</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_buffer</span> <span class="o">=</span> <span class="n">Buffer</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">BufferCreate</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">BufferUsage</span><span class="o">.</span><span class="n">TRANSFER_DST</span> <span class="o">|</span> <span class="n">usage</span><span class="p">,</span>
            <span class="n">sharing_mode</span><span class="p">,</span> <span class="n">queue_families</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">DEVICE_LOCAL</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy the staging buffer to the final buffer.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="n">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staging_buffer</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_buffer</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="HighPerformanceBuffer.bind"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.HighPerformanceBuffer.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Bind buffer for writing</span>

<span class="sd">        It calls `bind` method of the staging buffer and copy the buffer</span>
<span class="sd">        when the contextmanager is released. Must be used with `with`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">staging_buffer</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalize</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HighPerformanceImage"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.HighPerformanceImage">[docs]</a><span class="k">class</span> <span class="nc">HighPerformanceImage</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `HighPerformanceImage` allows to use high performance image to be</span>
<span class="sd">    sampled in your shaders.</span>

<span class="sd">    To get the maximum performance, we are going to create two `Image`,</span>
<span class="sd">    a staging image which memory can be updated (with our texture) and</span>
<span class="sd">    a final image with very fast memory that we will use in shaders.</span>
<span class="sd">    When we create an image, we first upload the pixels in the staging</span>
<span class="sd">    image and then copy the memory in the final image. Of course, both of</span>
<span class="sd">    the image have the same properties.</span>

<span class="sd">    **Note: MipMap generation is done only on the final image, the staging</span>
<span class="sd">            image don&#39;t need mipmap.**</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">image_type</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                 <span class="n">depth</span><span class="p">,</span> <span class="n">mip_level</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span>
                 <span class="n">sharing_mode</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">SharingMode</span><span class="o">.</span><span class="n">EXCLUSIVE</span><span class="p">,</span>
                 <span class="n">queue_families</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a high performance image</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `image_type`: `ImageType` vulk constant</span>
<span class="sd">        - `image_format`: `Format` of the image</span>
<span class="sd">        - `width`: Image width</span>
<span class="sd">        - `heigth`: Image height</span>
<span class="sd">        - `depth`: Image depth</span>
<span class="sd">        - `mip_level`: Level of mip (`int`) (only for final_image)</span>
<span class="sd">        - `layers`: Number of layers (`int`)</span>
<span class="sd">        - `samples`: This `SampleCount` vulk constant is related</span>
<span class="sd">                     to multisampling</span>
<span class="sd">        - `sharing_mode`: `SharingMode` vulk constant</span>
<span class="sd">        - `queue_families`: List of queue families accessing this image</span>
<span class="sd">                            (ignored if sharingMode is not `CONCURRENT`)</span>
<span class="sd">                            (can be [])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">queue_families</span><span class="p">:</span>
            <span class="n">queue_families</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Miplevel is applied automatically on final image if &gt; 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mip_level</span> <span class="o">=</span> <span class="n">mip_level</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">staging_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">image_type</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">layers</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">sharing_mode</span><span class="p">,</span> <span class="n">queue_families</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PREINITIALIZED</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageTiling</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_SRC</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_VISIBLE</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_COHERENT</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">image_type</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">mip_level</span><span class="p">,</span>
            <span class="n">layers</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">sharing_mode</span><span class="p">,</span> <span class="n">queue_families</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PREINITIALIZED</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageTiling</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_DST</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">SAMPLED</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">DEVICE_LOCAL</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_staging_to_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prepare and copy the staging image to the final image.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">commandpool</span> <span class="o">=</span> <span class="n">CommandPool</span><span class="p">(</span><span class="n">context</span><span class="p">,</span>
                                  <span class="n">context</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">])</span>

        <span class="c1"># Transition the staging image to optimal source transfert layout</span>
        <span class="k">with</span> <span class="n">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandpool</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staging_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PREINITIALIZED</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">HOST_WRITE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_READ</span>
            <span class="p">)</span>

        <span class="c1"># Transition the final image to optimal destination transfert layout</span>
        <span class="k">with</span> <span class="n">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandpool</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PREINITIALIZED</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">HOST_WRITE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span>
            <span class="p">)</span>

        <span class="c1"># Copy staging image into final image</span>
        <span class="k">with</span> <span class="n">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandpool</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">staging_image</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="p">)</span>

        <span class="c1"># Set the best layout for the final image</span>
        <span class="k">with</span> <span class="n">immediate_buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">commandpool</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">SHADER_READ_ONLY_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">SHADER_READ</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prepare and copy the staging image to the final image.</span>
<span class="sd">        Generate Mipmap if needed.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_staging_to_final</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="HighPerformanceImage.bind"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.HighPerformanceImage.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Bind image for writing</span>

<span class="sd">        It calls `bind` method of the staging image and copy the image</span>
<span class="sd">        when the contextmanager is released. Must be used with `with`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">staging_image</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalize</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `Image` is a wrapper around a `VkImage` and a `VkMemory`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">image_type</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span>
                 <span class="n">mip_level</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">sharing_mode</span><span class="p">,</span> <span class="n">queue_families</span><span class="p">,</span>
                 <span class="n">layout</span><span class="p">,</span> <span class="n">tiling</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">memory_properties</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a new image</span>

<span class="sd">        Creating an image is made of several steps:</span>

<span class="sd">        - Create the image</span>
<span class="sd">        - Allocate the memory</span>
<span class="sd">        - Bind the memory to the image</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `image_type`: `ImageType` vulk constant</span>
<span class="sd">        - `image_format`: `Format` vulk constant</span>
<span class="sd">        - `width`: Image width</span>
<span class="sd">        - `heigth`: Image height</span>
<span class="sd">        - `depth`: Image depth</span>
<span class="sd">        - `mip_level`: Level of mip (`int`)</span>
<span class="sd">        - `layers`: Number of layers (`int`)</span>
<span class="sd">        - `samples`: This `SampleCount` vulk constant is related</span>
<span class="sd">                     to multisampling</span>
<span class="sd">        - `sharing_mode`: `SharingMode` vulk constant</span>
<span class="sd">        - `queue_families`: List of queue families accessing this image</span>
<span class="sd">                            (ignored if sharingMode is not `CONCURRENT`)</span>
<span class="sd">                            (can be [])</span>
<span class="sd">        - `layout`: `ImageLayout` vulk constant</span>
<span class="sd">        - `tiling`: `ImageTiling` vulk constant</span>
<span class="sd">        - `usage`: `ImageUsage` vulk constant</span>
<span class="sd">        - `memory_properties`: `MemoryProperty` vulk constant</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mip_level</span> <span class="o">=</span> <span class="n">mip_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">image_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span> <span class="o">=</span> <span class="n">memory_properties</span>
        <span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="o">.</span><span class="n">value</span>
        <span class="n">tiling</span> <span class="o">=</span> <span class="n">tiling</span><span class="o">.</span><span class="n">value</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">value</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Check that image can be created</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceImageFormatProperties</span><span class="p">(</span>
                <span class="n">context</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">image_type</span><span class="p">,</span> <span class="n">tiling</span><span class="p">,</span>
                <span class="n">usage</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkErrorFormatNotSupported</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t create image, format &quot;</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not supported&quot;</span> <span class="o">%</span> <span class="n">image_format</span><span class="p">)</span>

        <span class="c1"># Create the VkImage</span>
        <span class="n">vk_extent</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkExtent3D</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                                  <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                  <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>

        <span class="n">image_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">imageType</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">vk_extent</span><span class="p">,</span>
            <span class="n">mipLevels</span><span class="o">=</span><span class="n">mip_level</span><span class="p">,</span>
            <span class="n">arrayLayers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span>
            <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">tiling</span><span class="o">=</span><span class="n">tiling</span><span class="p">,</span>
            <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span>
            <span class="n">sharingMode</span><span class="o">=</span><span class="n">sharing_mode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">queueFamilyIndexCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">queue_families</span><span class="p">),</span>
            <span class="n">pQueueFamilyIndices</span><span class="o">=</span><span class="n">queue_families</span> <span class="k">if</span> <span class="n">queue_families</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">initialLayout</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateImage</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">image_create</span><span class="p">)</span>

        <span class="c1"># Get memory requirements</span>
        <span class="n">requirements</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetImageMemoryRequirements</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

        <span class="n">alloc_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkMemoryAllocateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO</span><span class="p">,</span>
            <span class="n">allocationSize</span><span class="o">=</span><span class="n">requirements</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="n">memoryTypeIndex</span><span class="o">=</span><span class="n">find_memory_type</span><span class="p">(</span>
                <span class="n">context</span><span class="p">,</span>
                <span class="n">requirements</span><span class="o">.</span><span class="n">memoryTypeBits</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkAllocateMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">alloc_info</span><span class="p">)</span>

        <span class="c1"># Bind device memory to the image</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkBindImageMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="Image.update_layout"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Image.update_layout">[docs]</a>    <span class="k">def</span> <span class="nf">update_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">old_layout</span><span class="p">,</span> <span class="n">new_layout</span><span class="p">,</span> <span class="n">src_stage</span><span class="p">,</span>
                      <span class="n">dst_stage</span><span class="p">,</span> <span class="n">src_access</span><span class="p">,</span> <span class="n">dst_access</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the image layout.</span>
<span class="sd">        Command to update layout are registered in the commandbuffer</span>
<span class="sd">        but it&#39;s up to you to start and submit the command buffer to</span>
<span class="sd">        the execution queue.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `cmd`: `CommandBufferRegister` used to register commands</span>
<span class="sd">        - `old_layout`: `ImageLayout` vulk constant</span>
<span class="sd">        - `new_layout`: `ImageLayout` vulk constant</span>
<span class="sd">        - `src_stage`: `PipelineStage` vulk constant</span>
<span class="sd">        - `dst_stage`: `PipelineStage` vulk constant</span>
<span class="sd">        - `src_access`: `Access` vulk constant</span>
<span class="sd">        - `dst_access`: `Access` vulk constant</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">subresource_range</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageSubresourceRange</span><span class="p">(</span>
            <span class="n">aspectMask</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span>
            <span class="n">baseMipLevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">levelCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">baseArrayLayer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">layerCount</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="n">barrier</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageMemoryBarrier</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER</span><span class="p">,</span>
            <span class="n">srcAccessMask</span><span class="o">=</span><span class="n">src_access</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">dstAccessMask</span><span class="o">=</span><span class="n">dst_access</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">oldLayout</span><span class="o">=</span><span class="n">old_layout</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">newLayout</span><span class="o">=</span><span class="n">new_layout</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">srcQueueFamilyIndex</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">QUEUE_FAMILY_IGNORED</span><span class="p">,</span>
            <span class="n">dstQueueFamilyIndex</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">QUEUE_FAMILY_IGNORED</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
            <span class="n">subresourceRange</span><span class="o">=</span><span class="n">subresource_range</span>
        <span class="p">)</span>

        <span class="n">cmd</span><span class="o">.</span><span class="n">pipeline_barrier</span><span class="p">(</span><span class="n">src_stage</span><span class="p">,</span> <span class="n">dst_stage</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Dependency</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                             <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">barrier</span><span class="p">])</span></div>

<div class="viewcode-block" id="Image.generate_mipmap"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Image.generate_mipmap">[docs]</a>    <span class="k">def</span> <span class="nf">generate_mipmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate mipmap of this image based on `self.mip_level`.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `cmd`: `CommandBufferRegister` used to register commands</span>

<span class="sd">        **Note: TODO about layout**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Image.copy_to"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Image.copy_to">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">dst_image</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Copy this image to the destination image.</span>
<span class="sd">        Commands to copy are registered in the commandbuffer but it&#39;s up to</span>
<span class="sd">        you to start and submit the command buffer to the execution queue.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `cmd`: `CommandBufferRegister` used to register commands</span>
<span class="sd">        - `dst_image`: Destination `Image`</span>

<span class="sd">        **Note: Layout of source image must be `TRANSFERT_SRC_OPTIMAL` and</span>
<span class="sd">                layout of destination image must be `TRANSFERT_DST_OPTIMAL`.</span>
<span class="sd">                It&#39;s up to you.**</span>

<span class="sd">        **Warning: Format of both images must be compatible**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Copy image</span>
        <span class="n">subresource</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageSubresourceLayers</span><span class="p">(</span>
            <span class="n">aspectMask</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span>
            <span class="n">baseArrayLayer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">mipLevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">layerCount</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkExtent3D</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                               <span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageCopy</span><span class="p">(</span>
            <span class="n">srcSubresource</span><span class="o">=</span><span class="n">subresource</span><span class="p">,</span>
            <span class="n">dstSubresource</span><span class="o">=</span><span class="n">subresource</span><span class="p">,</span>
            <span class="n">srcOffset</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkOffset3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">dstOffset</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkOffset3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">extent</span>
        <span class="p">)</span>

        <span class="n">src_layout</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span>
        <span class="n">dst_layout</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span>

        <span class="n">cmd</span><span class="o">.</span><span class="n">copy_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_layout</span><span class="p">,</span> <span class="n">dst_image</span><span class="p">,</span>
                       <span class="n">dst_layout</span><span class="p">,</span> <span class="p">[</span><span class="n">region</span><span class="p">])</span></div>

    <span class="nd">@contextmanager</span>
<div class="viewcode-block" id="Image.bind"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Image.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Map this image to upload data in it.</span>
<span class="sd">        This function is a context manager and must be called with `with`.</span>
<span class="sd">        It return a python buffer and let you do what you want with it,</span>
<span class="sd">        be careful!</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>

<span class="sd">        **Warning: Image memory must be host visible**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">compatible_memories</span> <span class="o">=</span> <span class="p">{</span><span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_VISIBLE</span><span class="p">,</span>
                               <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_COHERENT</span><span class="p">,</span>
                               <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">HOST_CACHED</span><span class="p">}</span>
        <span class="c1"># TODO: To try, not sure it works</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_properties</span> <span class="o">&amp;</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">compatible_memories</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t map this image, memory must be host visible&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">format_size</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">format_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">*</span> <span class="n">format_size</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkMapMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">image_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">data</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">vkUnmapMemory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ImageView"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ImageView">[docs]</a><span class="k">class</span> <span class="nc">ImageView</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An image view is quite literally a view into an image.</span>
<span class="sd">    It describes how to access the image and which part of the image</span>
<span class="sd">    to access, for example if it should be treated as a 2D texture depth</span>
<span class="sd">    texture without any mipmapping levels.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">view_type</span><span class="p">,</span> <span class="n">image_format</span><span class="p">,</span>
                 <span class="n">subresource_range</span><span class="p">,</span> <span class="n">swizzle_r</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ComponentSwizzle</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">,</span>
                 <span class="n">swizzle_g</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ComponentSwizzle</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">,</span>
                 <span class="n">swizzle_b</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ComponentSwizzle</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">,</span>
                 <span class="n">swizzle_a</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ComponentSwizzle</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create ImageView</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `image`: The `Image` to work on</span>
<span class="sd">        - `view_type`: `ImageViewType` vulk constant</span>
<span class="sd">        - `image_format`: `Format` vulk constant</span>
<span class="sd">        - `subresource_range`: The `ImageSubresourceRange` to use</span>
<span class="sd">        - `swizzle_r`: `ComponentSwizzle` of the red color channel</span>
<span class="sd">        - `swizzle_g`: `ComponentSwizzle` of the green color channel</span>
<span class="sd">        - `swizzle_b`: `ComponentSwizzle` of the blue color channel</span>
<span class="sd">        - `swizzle_a`: `ComponentSwizzle` of the alpha color channel</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkComponentMapping</span><span class="p">(</span>
            <span class="n">r</span><span class="o">=</span><span class="n">swizzle_r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">swizzle_g</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">swizzle_b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">a</span><span class="o">=</span><span class="n">swizzle_a</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

        <span class="n">vk_subresource_range</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageSubresourceRange</span><span class="p">(</span>
            <span class="n">aspectMask</span><span class="o">=</span><span class="n">subresource_range</span><span class="o">.</span><span class="n">aspect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">baseMipLevel</span><span class="o">=</span><span class="n">subresource_range</span><span class="o">.</span><span class="n">base_miplevel</span><span class="p">,</span>
            <span class="n">levelCount</span><span class="o">=</span><span class="n">subresource_range</span><span class="o">.</span><span class="n">level_count</span><span class="p">,</span>
            <span class="n">baseArrayLayer</span><span class="o">=</span><span class="n">subresource_range</span><span class="o">.</span><span class="n">base_layer</span><span class="p">,</span>
            <span class="n">layerCount</span><span class="o">=</span><span class="n">subresource_range</span><span class="o">.</span><span class="n">layer_count</span>
        <span class="p">)</span>

        <span class="n">imageview_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkImageViewCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
            <span class="n">viewType</span><span class="o">=</span><span class="n">view_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">image_format</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
            <span class="n">subresourceRange</span><span class="o">=</span><span class="n">vk_subresource_range</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageview</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateImageView</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">imageview_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="Pipeline"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Pipeline">[docs]</a><span class="k">class</span> <span class="nc">Pipeline</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Pipeline (graphic) object</span>

<span class="sd">    The graphics pipeline is the sequence of operations that take the</span>
<span class="sd">    vertices and textures of your meshes all the way to the pixels in</span>
<span class="sd">    the render targets. The pipeline combines the following elements:</span>

<span class="sd">      - Shader stages: the shader modules that define the functionality of</span>
<span class="sd">                       the programmable stages of the graphics pipeline</span>
<span class="sd">      - Fixed-function state: all of the structures that define the</span>
<span class="sd">                              fixed-function stages of the pipeline, like</span>
<span class="sd">                              input assembly, rasterizer, viewport and</span>
<span class="sd">                              color blending</span>
<span class="sd">      - Pipeline layout: the uniform and push values referenced by the</span>
<span class="sd">                         shader that can be updated at draw time</span>
<span class="sd">      - Render pass: the attachments referenced by the pipeline stages</span>
<span class="sd">                     and their usage</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">stages</span><span class="p">,</span> <span class="n">vertex_input</span><span class="p">,</span> <span class="n">input_assembly</span><span class="p">,</span>
                 <span class="n">viewport_state</span><span class="p">,</span> <span class="n">rasterization</span><span class="p">,</span> <span class="n">multisample</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">blend</span><span class="p">,</span>
                 <span class="n">dynamic</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">renderpass</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `stages`: List of `PipelineShaderStage`</span>
<span class="sd">        - `vertex_input`: `PipelineVertexInputState`</span>
<span class="sd">        - `input_assembly`: `PipelineInputAssemblyState`</span>
<span class="sd">        - `viewport_state`: `PipelineViewportState`</span>
<span class="sd">        - `rasterization`: `PipelineRasterizationState`</span>
<span class="sd">        - `multisample`: `PipelineMultisampleState`</span>
<span class="sd">        - `depth`: `PipelineDepthStencilState` (can be `None`)</span>
<span class="sd">        - `blend`: `PipelineColorBlendState`</span>
<span class="sd">        - `dynamic`: `PipelineDynamicState` (may be `None`)</span>
<span class="sd">        - `layout`: `PipelineLayout`</span>
<span class="sd">        - `renderpass`: The `Renderpass` of this pipeline</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">vk_stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
            <span class="n">vk_stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineShaderStageCreateInfo</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_SHADER_STAGE_CREATE_INFO</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">stage</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                <span class="n">pSpecializationInfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">pName</span><span class="o">=</span><span class="s1">&#39;main&#39;</span>
            <span class="p">))</span>

        <span class="n">vk_vertex_bindings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">binding</span> <span class="ow">in</span> <span class="n">vertex_input</span><span class="o">.</span><span class="n">bindings</span><span class="p">:</span>
            <span class="n">vk_vertex_bindings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkVertexInputBindingDescription</span><span class="p">(</span>
                <span class="n">binding</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">binding</span><span class="p">,</span>
                <span class="n">stride</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span>
                <span class="n">inputRate</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">value</span>
            <span class="p">))</span>

        <span class="n">vk_vertex_attributes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">vertex_input</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="n">vk_vertex_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkVertexInputAttributeDescription</span><span class="p">(</span>
                <span class="n">location</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                <span class="n">binding</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">binding</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">attribute</span><span class="o">.</span><span class="n">offset</span>
            <span class="p">))</span>

        <span class="n">vk_vertex_input</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineVertexInputStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_VERTEX_INPUT_STATE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">vertexBindingDescriptionCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_vertex_bindings</span><span class="p">),</span>
            <span class="n">pVertexBindingDescriptions</span><span class="o">=</span><span class="n">vk_vertex_bindings</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vertexAttributeDescriptionCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_vertex_attributes</span><span class="p">),</span>
            <span class="n">pVertexAttributeDescriptions</span><span class="o">=</span><span class="n">vk_vertex_attributes</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">vk_input_assembly</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineInputAssemblyStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_INPUT_ASSEMBLY_STATE_CREATE_INFO</span><span class="p">,</span> <span class="c1"># noqa</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">topology</span><span class="o">=</span><span class="n">input_assembly</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">primitiveRestartEnable</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span>
        <span class="p">)</span>

        <span class="n">vk_viewports</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">viewport_state</span><span class="o">.</span><span class="n">viewports</span><span class="p">:</span>
            <span class="n">vk_viewports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkViewport</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">minDepth</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">max_depth</span>
            <span class="p">))</span>

        <span class="n">vk_scissors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">viewport_state</span><span class="o">.</span><span class="n">scissors</span><span class="p">:</span>
            <span class="n">vk_scissors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkRect2D</span><span class="p">(</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkOffset2D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">offset</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">offset</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VkExtent2D</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                     <span class="n">height</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">height</span><span class="p">),</span>
            <span class="p">))</span>

        <span class="n">vk_viewport_state</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineViewportStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_VIEWPORT_STATE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">viewportCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_viewports</span><span class="p">),</span>
            <span class="n">pViewports</span><span class="o">=</span><span class="n">vk_viewports</span><span class="p">,</span>
            <span class="n">scissorCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_scissors</span><span class="p">),</span>
            <span class="n">pScissors</span><span class="o">=</span><span class="n">vk_scissors</span>
        <span class="p">)</span>

        <span class="n">dbe</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_constant</span> <span class="ow">or</span>
           <span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_clamp</span> <span class="ow">or</span>
           <span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_slope</span><span class="p">):</span>
            <span class="n">dbe</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_TRUE</span>

        <span class="n">vk_rasterization</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineRasterizationStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_RASTERIZATION_STATE_CREATE_INFO</span><span class="p">,</span> <span class="c1"># noqa</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">depthClampEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">rasterization</span><span class="o">.</span><span class="n">depth_clamp_enable</span><span class="p">),</span>
            <span class="n">rasterizerDiscardEnable</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span><span class="p">,</span>
            <span class="n">polygonMode</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">polygon_mode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">lineWidth</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">line_width</span><span class="p">,</span>
            <span class="n">cullMode</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">cull_mode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">frontFace</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">front_face</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">depthBiasEnable</span><span class="o">=</span><span class="n">dbe</span><span class="p">,</span>
            <span class="n">depthBiasConstantFactor</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_constant</span><span class="p">,</span>
            <span class="n">depthBiasClamp</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_clamp</span><span class="p">,</span>
            <span class="n">depthBiasSlopeFactor</span><span class="o">=</span><span class="n">rasterization</span><span class="o">.</span><span class="n">depth_bias_slope</span>
        <span class="p">)</span>

        <span class="n">vk_multisample</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineMultisampleStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_MULTISAMPLE_STATE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">sampleShadingEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">multisample</span><span class="o">.</span><span class="n">shading_enable</span><span class="p">),</span>
            <span class="n">rasterizationSamples</span><span class="o">=</span><span class="n">multisample</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">minSampleShading</span><span class="o">=</span><span class="n">multisample</span><span class="o">.</span><span class="n">min_sample_shading</span><span class="p">,</span>
            <span class="n">pSampleMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alphaToCoverageEnable</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span><span class="p">,</span>
            <span class="n">alphaToOneEnable</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_FALSE</span>
        <span class="p">)</span>

        <span class="n">vk_depth</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">depth</span><span class="p">:</span>
            <span class="n">vk_depth</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineDepthStencilStateCreateInfo</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_DEPTH_STENCIL_STATE_CREATE_INFO</span><span class="p">,</span> <span class="c1"># noqa</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">depthTestEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">depth_test_enable</span><span class="p">),</span>
                <span class="n">depthWriteEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">depth_write_enable</span><span class="p">),</span>
                <span class="n">depthCompareOp</span><span class="o">=</span><span class="n">depth</span><span class="o">.</span><span class="n">depth_compare</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">depthBoundsTestEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">depth_bounds_test_enable</span><span class="p">),</span>
                <span class="n">stencilTestEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">stencil_test_enable</span><span class="p">),</span>
                <span class="n">front</span><span class="o">=</span><span class="n">depth</span><span class="o">.</span><span class="n">front</span><span class="p">,</span>
                <span class="n">back</span><span class="o">=</span><span class="n">depth</span><span class="o">.</span><span class="n">back</span><span class="p">,</span>
                <span class="n">minDepthBounds</span><span class="o">=</span><span class="n">depth</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                <span class="n">maxDepthBounds</span><span class="o">=</span><span class="n">depth</span><span class="o">.</span><span class="n">max</span>
            <span class="p">)</span>

        <span class="n">vk_blend_attachments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">blend</span><span class="o">.</span><span class="n">attachments</span><span class="p">:</span>
            <span class="n">vk_a</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineColorBlendAttachmentState</span><span class="p">(</span>
                <span class="n">colorWriteMask</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">color_mask</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">blendEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">enable</span><span class="p">),</span>
                <span class="n">srcColorBlendFactor</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">src_color</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dstColorBlendFactor</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">dst_color</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">colorBlendOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">color_op</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">srcAlphaBlendFactor</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">src_alpha</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dstAlphaBlendFactor</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">dst_alpha</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">alphaBlendOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">alpha_op</span><span class="o">.</span><span class="n">value</span>
            <span class="p">)</span>
            <span class="n">vk_blend_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk_a</span><span class="p">)</span>

        <span class="n">vk_blend</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineColorBlendStateCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_COLOR_BLEND_STATE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">logicOpEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">blend</span><span class="o">.</span><span class="n">op_enable</span><span class="p">),</span>
            <span class="n">logicOp</span><span class="o">=</span><span class="n">blend</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">attachmentCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_blend_attachments</span><span class="p">),</span>
            <span class="n">pAttachments</span><span class="o">=</span><span class="n">vk_blend_attachments</span><span class="p">,</span>
            <span class="n">blendConstants</span><span class="o">=</span><span class="n">blend</span><span class="o">.</span><span class="n">constants</span>
        <span class="p">)</span>

        <span class="n">vk_dynamic</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">vk_dynamic</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineDynamicStateCreateInfo</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_DYNAMIC_STATE_CREATE_INFO</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dynamicStateCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dynamic</span><span class="o">.</span><span class="n">states</span><span class="p">),</span>
                <span class="n">pDynamicStates</span><span class="o">=</span><span class="n">dynamic</span><span class="o">.</span><span class="n">states</span>
            <span class="p">)</span>

        <span class="n">pipeline_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkGraphicsPipelineCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">stageCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_stages</span><span class="p">),</span>
            <span class="n">pStages</span><span class="o">=</span><span class="n">vk_stages</span><span class="p">,</span>
            <span class="n">pVertexInputState</span><span class="o">=</span><span class="n">vk_vertex_input</span><span class="p">,</span>
            <span class="n">pInputAssemblyState</span><span class="o">=</span><span class="n">vk_input_assembly</span><span class="p">,</span>
            <span class="n">pTessellationState</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">pViewportState</span><span class="o">=</span><span class="n">vk_viewport_state</span><span class="p">,</span>
            <span class="n">pRasterizationState</span><span class="o">=</span><span class="n">vk_rasterization</span><span class="p">,</span>
            <span class="n">pMultisampleState</span><span class="o">=</span><span class="n">vk_multisample</span><span class="p">,</span>
            <span class="n">pDepthStencilState</span><span class="o">=</span><span class="n">vk_depth</span><span class="p">,</span>
            <span class="n">pColorBlendState</span><span class="o">=</span><span class="n">vk_blend</span><span class="p">,</span>
            <span class="n">pDynamicState</span><span class="o">=</span><span class="n">vk_dynamic</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">renderPass</span><span class="o">=</span><span class="n">renderpass</span><span class="o">.</span><span class="n">renderpass</span><span class="p">,</span>
            <span class="n">subpass</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">basePipelineHandle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">basePipelineIndex</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateGraphicsPipelines</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                     <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">pipeline_create</span><span class="p">])</span></div>


<div class="viewcode-block" id="PipelineLayout"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.PipelineLayout">[docs]</a><span class="k">class</span> <span class="nc">PipelineLayout</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Pipeline layout object</span>

<span class="sd">    Access to descriptor sets from a pipeline is accomplished through a</span>
<span class="sd">    pipeline layout. Zero or more descriptor set layouts and zero or more</span>
<span class="sd">    push constant ranges are combined to form a pipeline layout object which</span>
<span class="sd">    describes the complete set of resources that can be accessed by a</span>
<span class="sd">    pipeline. The pipeline layout represents a sequence of descriptor sets</span>
<span class="sd">    with each having a specific layout. This sequence of layouts is used to</span>
<span class="sd">    determine the interface between shader stages and shader resources.</span>
<span class="sd">    Each pipeline is created using a pipeline layout.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `descriptors`: `list` of `DescriptorSetLayout`</span>

<span class="sd">        **Todo: push constants must be implemented**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vk_descriptors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">descriptors</span><span class="p">:</span>
            <span class="n">vk_descriptors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">descriptorsetlayout</span><span class="p">)</span>

        <span class="n">layout_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPipelineLayoutCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PIPELINE_LAYOUT_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">setLayoutCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_descriptors</span><span class="p">),</span>
            <span class="n">pSetLayouts</span><span class="o">=</span><span class="n">vk_descriptors</span> <span class="k">if</span> <span class="n">vk_descriptors</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">pushConstantRangeCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">pPushConstantRanges</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreatePipelineLayout</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                <span class="n">layout_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="Renderpass"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Renderpass">[docs]</a><span class="k">class</span> <span class="nc">Renderpass</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Renderpass object</span>

<span class="sd">    When creating the pipeline, we need to tell Vulkan about the</span>
<span class="sd">    framebuffer attachments that will be used while rendering. We need to</span>
<span class="sd">    specify how many color and depth buffers there will be, how many samples</span>
<span class="sd">    to use for each of them and how their contents should be handled</span>
<span class="sd">    throughout the rendering operations. All of this information is wrapped</span>
<span class="sd">    in a RenderPass object</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">attachments</span><span class="p">,</span> <span class="n">subpasses</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Renderpass constructor</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext`</span>
<span class="sd">        - `attachments`: `list` of `AttachmentDescription`</span>
<span class="sd">        - `subpasses`: `list` of `SubpassDescription`</span>
<span class="sd">        - `dependencies`: `list` of `SubpassDependency`</span>

<span class="sd">        **Warning: Arguments ar not checked, you must know</span>
<span class="sd">                   what you are doing.**</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">vk_attachments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="n">vk_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkAttachmentDescription</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">samples</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">loadOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">load</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">storeOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">stencilLoadOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">stencil_load</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">stencilStoreOp</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">stencil_store</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">initialLayout</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">initial_layout</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">finalLayout</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">final_layout</span><span class="o">.</span><span class="n">value</span>
            <span class="p">))</span>

        <span class="c1"># Loop through the list of subpasses to create the reference</span>
        <span class="c1"># reference key is index_layout</span>
        <span class="n">vk_references</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subpasses</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">colors</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">inputs</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">resolves</span> <span class="o">+</span>
                      <span class="n">s</span><span class="o">.</span><span class="n">preserves</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">depth_stencil</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vk_references</span><span class="p">:</span>
                    <span class="n">vk_references</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkAttachmentReference</span><span class="p">(</span>
                        <span class="n">attachment</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                        <span class="n">layout</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">)</span>

        <span class="k">def</span> <span class="nf">ref</span><span class="p">(</span><span class="n">references</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Convert a list of `AttachmentReference` to a list of</span>
<span class="sd">            `VkAttachmentReference` by using the cached references in</span>
<span class="sd">            `vk_references`</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">references</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">vk_references</span><span class="p">[(</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">layout</span><span class="p">)]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">references</span><span class="p">]</span>

        <span class="c1"># Create the subpasses using references</span>
        <span class="n">vk_subpasses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subpasses</span><span class="p">:</span>
            <span class="n">leninputs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">lenpreserves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">preserves</span><span class="p">)</span>
            <span class="n">lencolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
            <span class="n">lenresolves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">resolves</span><span class="p">)</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">preserves</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">preserves</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">resolves</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">resolves</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">depth_stencil</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">depth_stencil</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">resolves</span> <span class="ow">and</span> <span class="n">inputs</span> <span class="ow">and</span> <span class="n">lenresolves</span> <span class="o">!=</span> <span class="n">lencolors</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;resolves and inputs list must be of the same size&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">vk_subpasses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkSubpassDescription</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">pipelineBindPoint</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineBindPoint</span><span class="o">.</span><span class="n">GRAPHICS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">inputAttachmentCount</span><span class="o">=</span><span class="n">leninputs</span><span class="p">,</span>
                <span class="n">pInputAttachments</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
                <span class="n">colorAttachmentCount</span><span class="o">=</span><span class="n">lencolors</span><span class="p">,</span>
                <span class="n">pColorAttachments</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">pResolveAttachments</span><span class="o">=</span><span class="n">resolves</span><span class="p">,</span>
                <span class="n">preserveAttachmentCount</span><span class="o">=</span><span class="n">lenpreserves</span><span class="p">,</span>
                <span class="n">pPreserveAttachments</span><span class="o">=</span><span class="n">preserves</span><span class="p">,</span>
                <span class="n">pDepthStencilAttachment</span><span class="o">=</span><span class="n">depth_stencil</span>
            <span class="p">))</span>

        <span class="c1"># Create the dependancies</span>
        <span class="n">vk_dependencies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">:</span>
            <span class="n">vk_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VkSubpassDependency</span><span class="p">(</span>
                <span class="n">dependencyFlags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">srcSubpass</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">src_subpass</span><span class="p">,</span>
                <span class="n">dstSubpass</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">dst_subpass</span><span class="p">,</span>
                <span class="n">srcStageMask</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">src_stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dstStageMask</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">dst_stage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">srcAccessMask</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">src_access</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dstAccessMask</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">dst_access</span><span class="o">.</span><span class="n">value</span>
            <span class="p">))</span>

        <span class="c1"># Create the render pass</span>
        <span class="n">renderpass_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkRenderPassCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">attachmentCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_attachments</span><span class="p">),</span>
            <span class="n">pAttachments</span><span class="o">=</span><span class="n">vk_attachments</span><span class="p">,</span>
            <span class="n">subpassCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_subpasses</span><span class="p">),</span>
            <span class="n">pSubpasses</span><span class="o">=</span><span class="n">vk_subpasses</span><span class="p">,</span>
            <span class="n">dependencyCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vk_dependencies</span><span class="p">),</span>
            <span class="n">pDependencies</span><span class="o">=</span><span class="n">vk_dependencies</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">renderpass</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateRenderPass</span><span class="p">(</span>
            <span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">renderpass_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="Sampler"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Sampler">[docs]</a><span class="k">class</span> <span class="nc">Sampler</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `Sampler` objects represent the state of an image sampler which is used</span>
<span class="sd">    by the implementation to read image data and apply filtering and other</span>
<span class="sd">    transformations for the shader.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">mag_filter</span><span class="p">,</span> <span class="n">min_filter</span><span class="p">,</span> <span class="n">mipmap_mode</span><span class="p">,</span>
                 <span class="n">address_mode_u</span><span class="p">,</span> <span class="n">address_mode_v</span><span class="p">,</span> <span class="n">address_mode_w</span><span class="p">,</span> <span class="n">mip_lod_bias</span><span class="p">,</span>
                 <span class="n">anisotropy_enable</span><span class="p">,</span> <span class="n">max_anisotropy</span><span class="p">,</span> <span class="n">compare_enable</span><span class="p">,</span>
                 <span class="n">compare_op</span><span class="p">,</span> <span class="n">min_lod</span><span class="p">,</span> <span class="n">max_lod</span><span class="p">,</span> <span class="n">border_color</span><span class="p">,</span>
                 <span class="n">unnormalized_coordinates</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `mag_filter`: Magnification `Filter` to apply to lookups</span>
<span class="sd">        - `min_filter`: Minification `Filter` to apply to lookups</span>
<span class="sd">        - `mipmap_mode`: `SamplerMipmapMode` mipmap filter to apply to</span>
<span class="sd">                         lookups</span>
<span class="sd">        - `address_mode_u`: `SamplerAddressMode` vulk constant</span>
<span class="sd">        - `address_mode_v`: `SamplerAddressMode` vulk contant</span>
<span class="sd">        - `address_mode_w`: `SamplerAddressMode` vulk contant</span>
<span class="sd">        - `mip_lod_bias`: Bias to be added to mipmap LOD calculation</span>
<span class="sd">        - `anisotropy_enable`: `True` to enable anisotropic filtering</span>
<span class="sd">        - `max_anisotropy`: Anisotropy value clamp</span>
<span class="sd">        - `compare_enable`: `True` to enable comparison against a reference</span>
<span class="sd">                            value during lookups</span>
<span class="sd">        - `compare_op`: `CompareOp` vulk constant comparison function to apply</span>
<span class="sd">                        to fetched data before filtering</span>
<span class="sd">        - `min_lod`: Value used to clamp the computed level-of-detail value</span>
<span class="sd">        - `max_lod`: Value used to clamp the computed level-of-detail value</span>
<span class="sd">        - `border_color`: `BorderColor` predefined border color to use</span>
<span class="sd">        - `unnormalized_coordinates`: `True` to use unnormalized texel</span>
<span class="sd">                                      coordinates</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sampler_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSamplerCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SAMPLER_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">magFilter</span><span class="o">=</span><span class="n">mag_filter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">minFilter</span><span class="o">=</span><span class="n">min_filter</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">mipmapMode</span><span class="o">=</span><span class="n">mipmap_mode</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">addressModeU</span><span class="o">=</span><span class="n">address_mode_u</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">addressModeV</span><span class="o">=</span><span class="n">address_mode_v</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">addressModeW</span><span class="o">=</span><span class="n">address_mode_w</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">mipLodBias</span><span class="o">=</span><span class="n">mip_lod_bias</span><span class="p">,</span>
            <span class="n">anisotropyEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">anisotropy_enable</span><span class="p">),</span>
            <span class="n">maxAnisotropy</span><span class="o">=</span><span class="n">max_anisotropy</span><span class="p">,</span>
            <span class="n">compareEnable</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">compare_enable</span><span class="p">),</span>
            <span class="n">compareOp</span><span class="o">=</span><span class="n">compare_op</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">minLod</span><span class="o">=</span><span class="n">min_lod</span><span class="p">,</span>
            <span class="n">maxLod</span><span class="o">=</span><span class="n">max_lod</span><span class="p">,</span>
            <span class="n">borderColor</span><span class="o">=</span><span class="n">border_color</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">unnormalizedCoordinates</span><span class="o">=</span><span class="n">btov</span><span class="p">(</span><span class="n">unnormalized_coordinates</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateSampler</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">sampler_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="Semaphore"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.Semaphore">[docs]</a><span class="k">class</span> <span class="nc">Semaphore</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Semaphores are a synchronization primitive that can be used to insert a</span>
<span class="sd">    dependency between batches submitted to queues. Semaphores have two</span>
<span class="sd">    states - signaled and unsignaled. The state of a semaphore can be signaled</span>
<span class="sd">    after execution of a batch of commands is completed. A batch can wait for</span>
<span class="sd">    a semaphore to become signaled before it begins execution, and the</span>
<span class="sd">    semaphore is also unsignaled before the batch begins execution.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">semaphore_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSemaphoreCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">semaphore</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateSemaphore</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">semaphore_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="ShaderModule"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ShaderModule">[docs]</a><span class="k">class</span> <span class="nc">ShaderModule</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;ShaderModule Vulkan object</span>

<span class="sd">    A shader module is a Spir-V shader loaded into Vulkan.</span>
<span class="sd">    After being created, it must be inserted in a pipeline stage.</span>
<span class="sd">    The real Vulkan module can be accessed by the &#39;module&#39; property.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize the module</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: The `VulkContext` object</span>
<span class="sd">        - `code`: Binary Spir-V loaded file (bytes)</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        The created `ShaderModule`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Type of code is not &#39;bytes&#39;, it may be an error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>

        <span class="c1"># Create the shader module</span>
        <span class="n">shader_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkShaderModuleCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">codeSize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">pCode</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateShaderModule</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">shader_create</span><span class="p">)</span></div>


<div class="viewcode-block" id="ShaderProgram"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ShaderProgram">[docs]</a><span class="k">class</span> <span class="nc">ShaderProgram</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;ShaderProgram</span>

<span class="sd">    A `ShaderProgram` embed all `ShaderModule` of a `Pipeline`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `modules`: `dict` containing a mapping between `ShaderStage` and the</span>
<span class="sd">                     actual shader. The shader must be a `bytes` object like</span>
<span class="sd">                     obtained by open(path, &#39;rb&#39;).read()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">spirv</span> <span class="ow">in</span> <span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spirv</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;shader must be a bytes object&quot;</span><span class="p">)</span>

            <span class="n">module</span> <span class="o">=</span> <span class="n">ShaderModule</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">spirv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PipelineShaderStage</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">stage</span><span class="p">))</span></div>


<div class="viewcode-block" id="ShaderProgramGlsl"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ShaderProgramGlsl">[docs]</a><span class="k">class</span> <span class="nc">ShaderProgramGlsl</span><span class="p">(</span><span class="n">ShaderProgram</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;ShaderProgramGlsl</span>

<span class="sd">    A `ShaderProgramGlsl` is a `ShaderProgram` which compiles glsl to spirv.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">shaderc_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">VERTEX</span><span class="p">:</span> <span class="s1">&#39;vert&#39;</span><span class="p">,</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">TESSELLATION_CONTROL</span><span class="p">:</span> <span class="s1">&#39;tesc&#39;</span><span class="p">,</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">TESSELLATION_EVALUATION</span><span class="p">:</span> <span class="s1">&#39;tese&#39;</span><span class="p">,</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">GEOMETRY</span><span class="p">:</span> <span class="s1">&#39;geom&#39;</span><span class="p">,</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">FRAGMENT</span><span class="p">:</span> <span class="s1">&#39;frag&#39;</span><span class="p">,</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">ShaderStage</span><span class="o">.</span><span class="n">COMPUTE</span><span class="p">:</span> <span class="s1">&#39;comp&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `modules`: `dict` containing a mapping between `ShaderStage` and</span>
<span class="sd">                     shader information.</span>
<span class="sd">                     modules = {</span>
<span class="sd">                         &#39;stage&#39;: {</span>
<span class="sd">                             &#39;glsl&#39;: glsl shader, `bytes` object,</span>
<span class="sd">                             &#39;path&#39;: path to file, needed if #include &quot;file&quot;</span>
<span class="sd">                         }</span>
<span class="sd">                     }</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">spirv_modules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">glsl</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;glsl&#39;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;nofile&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glsl</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;shader must be a bytes object&quot;</span><span class="p">)</span>

            <span class="n">stage_shaderc</span> <span class="o">=</span> <span class="n">ShaderProgramGlsl</span><span class="o">.</span><span class="n">shaderc_mapping</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
            <span class="n">spirv</span> <span class="o">=</span> <span class="n">pyshaderc</span><span class="o">.</span><span class="n">compile_into_spirv</span><span class="p">(</span><span class="n">glsl</span><span class="p">,</span> <span class="n">stage_shaderc</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="n">spirv_modules</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">spirv</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">spirv_modules</span><span class="p">)</span></div>


<div class="viewcode-block" id="ShaderProgramGlslFile"><a class="viewcode-back" href="../../vulk.html#vulk.vulkanobject.ShaderProgramGlslFile">[docs]</a><span class="k">class</span> <span class="nc">ShaderProgramGlslFile</span><span class="p">(</span><span class="n">ShaderProgramGlsl</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;ShaderProgramGlslFile</span>

<span class="sd">    It&#39;s a `ShaderProgramGlsl` which needs only file paths.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        *Parameters:*</span>

<span class="sd">        - `context`: `VulkContext`</span>
<span class="sd">        - `modules`: `dict` containing a mapping between `ShaderStage` and</span>
<span class="sd">                     shader path (glsl format).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">glsl_modules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">glsl_modules</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;glsl&#39;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">}</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">glsl_modules</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Vulk Engine.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>