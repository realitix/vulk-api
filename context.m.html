<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>vulk.context API documentation</title>
    <meta name="description" content="Module to create Window and Vulkan context

This module contains class to create the SDL2 window and..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#vulk.context.ENGINE_NAME">ENGINE_NAME</a></li>
    <li class="mono"><a href="#vulk.context.logger">logger</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#vulk.context.SDL2Error">SDL2Error</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#vulk.context.VulkContext">VulkContext</a></span>
        
          
  <ul>
    <li class="mono"><a href="#vulk.context.VulkContext.__init__">__init__</a></li>
    <li class="mono"><a href="#vulk.context.VulkContext.create">create</a></li>
    <li class="mono"><a href="#vulk.context.VulkContext.swap">swap</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#vulk.context.VulkWindow">VulkWindow</a></span>
        
          
  <ul>
    <li class="mono"><a href="#vulk.context.VulkWindow.__init__">__init__</a></li>
    <li class="mono"><a href="#vulk.context.VulkWindow.close">close</a></li>
    <li class="mono"><a href="#vulk.context.VulkWindow.open">open</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  

    <p id="nav">
      <a href="/vulk-api/">All packages</a>
      
        
        :: <a href="/vulk-api/vulk">vulk</a>
    </p>

  <header id="section-intro">
  <h1 class="title"><span class="name">vulk.context</span> module</h1>
  <p>Module to create Window and Vulkan context</p>

<p>This module contains class to create the SDL2 window and the Vulkan
logical device and queues.
The context will be then passed to the Application to use it.</p>

<p>Vulk uses a specific way to interact with Vulkan that allow a good
abstraction. Instead of performing the final drawing operation
directly on the swapchain's images, Vulk performs all operations on
custom images and framebuffer and finally just copy the result in the
swapchain's image.</p>

  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;Module to create Window and Vulkan context</span>

<span class="sd">This module contains class to create the SDL2 window and the Vulkan</span>
<span class="sd">logical device and queues.</span>
<span class="sd">The context will be then passed to the Application to use it.</span>

<span class="sd">Vulk uses a specific way to interact with Vulkan that allow a good</span>
<span class="sd">abstraction. Instead of performing the final drawing operation</span>
<span class="sd">directly on the swapchain&#39;s images, Vulk performs all operations on</span>
<span class="sd">custom images and framebuffer and finally just copy the result in the</span>
<span class="sd">swapchain&#39;s image.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sdl2</span>
<span class="kn">import</span> <span class="nn">sdl2.ext</span>
<span class="kn">import</span> <span class="nn">vulkan</span> <span class="kn">as</span> <span class="nn">vk</span>  <span class="c1"># pylint: disable=import-error</span>

<span class="kn">from</span> <span class="nn">vulk.exception</span> <span class="kn">import</span> <span class="n">VulkError</span>
<span class="kn">from</span> <span class="nn">vulk</span> <span class="kn">import</span> <span class="n">vulkanconstant</span> <span class="k">as</span> <span class="n">vc</span>
<span class="kn">from</span> <span class="nn">vulk</span> <span class="kn">import</span> <span class="n">vulkanobject</span> <span class="k">as</span> <span class="n">vo</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">ENGINE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Vulk 3D Engine&quot;</span>


<span class="k">class</span> <span class="nc">SDL2Error</span><span class="p">(</span><span class="n">VulkError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">VulkWindow</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Open the SDL2 Window</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configurations parameters from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Init</span><span class="p">(</span><span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_INIT_VIDEO</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span> <span class="ow">and</span> \
           <span class="n">configuration</span><span class="o">.</span><span class="n">width</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN</span>
        <span class="k">elif</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN_DESKTOP</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">decorated</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_BORDERLESS</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">resizable</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_RESIZABLE</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">highdpi</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_ALLOW_HIGHDPI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_CreateWindow</span><span class="p">(</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">configuration</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window opened with configuration: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="p">(</span><span class="n">configuration</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SysWMinfo</span><span class="p">()</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_VERSION</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetWindowWMInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window closed&quot;</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_DestroyWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Quit</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">VulkContext</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Vulkan instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Extension functions in a dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Instance to the debug callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Surface to the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Properties of physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Features of physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Logical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Graphic queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Presentation queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Indices of queue families</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain images (vulkanobject.Image type)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Width of the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Height of the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Final image which is copied into swapchain image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Image view of the final image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image_view</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Semaphores used during presentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Semaphores used for direct rendering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_semaphores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Command buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_instance_extensions</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get extensions which depend on the window and configuration</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The `VulkWindow`</span>
<span class="sd">        - `configuration`: Configuration from App</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        Extension list</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Get available extensions</span>
        <span class="n">available_extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">extensionName</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available instance extensions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">available_extensions</span><span class="p">)</span>

        <span class="c1"># Compute needed extensions</span>
        <span class="n">extension_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_X11</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_XLIB_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WINDOWS</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_WIN32_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WAYLAND</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_WAYLAND_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_MIR</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_MIR_SURFACE_EXTENSION_NAME</span>
        <span class="p">}</span>
        <span class="n">sdl_subsystem</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">subsystem</span>

        <span class="k">if</span> <span class="n">sdl_subsystem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extension_mapping</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan not supported on this plateform: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl_subsystem</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Select extension</span>
        <span class="n">enabled_extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_SURFACE_EXTENSION_NAME</span><span class="p">)</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extension_mapping</span><span class="p">[</span><span class="n">sdl_subsystem</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_EXT_DEBUG_REPORT_EXTENSION_NAME</span> <span class="ow">in</span> <span class="n">available_extensions</span><span class="p">:</span>
                <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">vk</span><span class="o">.</span><span class="n">VK_EXT_DEBUG_REPORT_EXTENSION_NAME</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Vulkan debug extension not present and debug&quot;</span>
                               <span class="s2">&quot;mode asked, disabling debug mode&quot;</span><span class="p">)</span>

        <span class="c1"># Check extensions availability</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">e</span> <span class="ow">in</span> <span class="n">available_extensions</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">enabled_extensions</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan extensions are not all available&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enabled_extensions</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_device_extensions</span><span class="p">(</span><span class="n">physical_device</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get device extensions</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `physical_device`: The VkPhysicalDevice to check</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        Extension list</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Get available extensions</span>
        <span class="n">available_extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">extensionName</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span>
                <span class="n">physical_device</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available device extensions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">available_extensions</span><span class="p">)</span>

        <span class="c1"># Select extensions</span>
        <span class="n">enabled_extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_SWAPCHAIN_EXTENSION_NAME</span><span class="p">)</span>

        <span class="c1"># Check extensions availability</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">e</span> <span class="ow">in</span> <span class="n">available_extensions</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">enabled_extensions</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan extensions are not all available&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enabled_extensions</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get all enabled layers</span>

<span class="sd">        Simple algorythm: return everything in debug mode else nothing</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - configuration: configuration from App</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        List of all enabled layers</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">layerName</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span>
                  <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateInstanceLayerProperties</span><span class="p">(</span><span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available layers: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>

        <span class="c1"># Standard validation is a meta layer containing the others</span>
        <span class="n">standard</span> <span class="o">=</span> <span class="s1">&#39;VK_LAYER_LUNARG_standard_validation&#39;</span>
        <span class="k">if</span> <span class="n">standard</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting only </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">standard</span><span class="p">)</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">standard</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">layers</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_queue_families</span><span class="p">(</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">pfn</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get graphic and present queue families</span>

<span class="sd">        Check for graphic and presentation queue families.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `physical_device`: The `VkPhysicalDevice` to check for</span>
<span class="sd">        - `surface`: The `VkSurfaceKHR` to present</span>
<span class="sd">        - `pfn`: Function `vkGetPhysicalDeviceSurfaceSupportKHR` callable</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        A tuple with graphic index and present index or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">queue_families</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physical_device</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="n">graphic_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">present_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">queue_family</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">queue_families</span><span class="p">):</span>
            <span class="c1"># Queue family needs queues</span>
            <span class="k">if</span> <span class="n">queue_family</span><span class="o">.</span><span class="n">queueCount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check that queue family support present queue</span>
            <span class="n">present_available</span> <span class="o">=</span> <span class="n">pfn</span><span class="p">(</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">surface</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">queue_family</span><span class="o">.</span><span class="n">queueFlags</span> <span class="o">&amp;</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">:</span>
                <span class="n">graphic_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">present_available</span><span class="p">:</span>
                <span class="n">present_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">if</span> <span class="n">graphic_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">present_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span>

    <span class="k">def</span> <span class="nf">_get_pfn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get extension function pointers</span>

<span class="sd">        Get only functions used in `VulkContext`, vulkan instance must exist</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;_create_instance must be called before _get_pfn&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_pfn</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetInstanceProcAddr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t get address of </span><span class="si">%s</span><span class="s2"> extension function&quot;</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">extension_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vkDestroySurfaceKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceCapabilitiesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceFormatsKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfacePresentModesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkCreateSwapchainKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetSwapchainImagesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkAcquireNextImageKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkQueuePresentKHR&#39;</span>
        <span class="p">}</span>

        <span class="n">debug_extension_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vkCreateDebugReportCallbackEXT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkDestroyDebugReportCallbackEXT&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">extension_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">debug_extension_functions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">extension_functions</span><span class="p">:</span>
            <span class="n">add_pfn</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan instance</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The window for Vulkan</span>
<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">extensions</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_instance_extensions</span><span class="p">(</span><span class="n">window</span><span class="p">,</span>
                                                          <span class="n">configuration</span><span class="p">)</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>

        <span class="n">app_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkApplicationInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">,</span>
            <span class="n">pApplicationName</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">applicationVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">pEngineName</span><span class="o">=</span><span class="n">ENGINE_NAME</span><span class="p">,</span>
            <span class="n">engineVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">apiVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_API_VERSION_1_0</span><span class="p">)</span>

        <span class="n">instance_create_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkInstanceCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">pApplicationInfo</span><span class="o">=</span><span class="n">app_info</span><span class="p">,</span>
            <span class="n">enabledExtensionCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">),</span>
            <span class="n">ppEnabledExtensionNames</span><span class="o">=</span><span class="n">extensions</span><span class="p">,</span>
            <span class="n">enabledLayerCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">),</span>
            <span class="n">ppEnabledLayerNames</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="n">pCreateInfo</span><span class="o">=</span><span class="n">instance_create_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_debug_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create debug callback</span>

<span class="sd">        It works only on debug mode</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">vulkan_debug_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_DEBUG_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_WARNING_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_ERROR_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_INFORMATION_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_PERFORMANCE_WARNING_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">debug_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vulkan_debug_mapping</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s2">&quot;VULKAN: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_ERROR_BIT_EXT</span> <span class="o">|</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_WARNING_BIT_EXT</span> <span class="o">|</span>
                 <span class="c1"># vk.VK_DEBUG_REPORT_INFORMATION_BIT_EXT |</span>
                 <span class="c1"># vk.VK_DEBUG_REPORT_DEBUG_BIT_EXT |</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_PERFORMANCE_WARNING_BIT_EXT</span><span class="p">)</span>

        <span class="n">debug_create_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDebugReportCallbackCreateInfoEXT</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEBUG_REPORT_CALLBACK_CREATE_INFO_EXT</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
            <span class="n">pfnCallback</span><span class="o">=</span><span class="n">debug_function</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkCreateDebugReportCallbackEXT&#39;</span><span class="p">](</span>
            <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
            <span class="n">pCreateInfo</span><span class="o">=</span><span class="n">debug_create_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan surface</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `info`: The window information for Vulkan</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">call_platform</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetInstanceProcAddr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">pCreateInfo</span><span class="o">=</span><span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">xlib</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create XLIB surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkXlibSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_XLIB_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">dpy</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">x11</span><span class="o">.</span><span class="n">display</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">x11</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateXlibSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mir</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create MIR surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkMirSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_MIR_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">connection</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">mir</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">mirSurface</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">mir</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateMirSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">wayland</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create WAYLAND surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkWaylandSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_WAYLAND_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">display</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">display</span><span class="p">,</span>
                <span class="n">surface</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateWaylandSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">windows</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create WINDOWS surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkWin32SurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_WAYLAND_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">hinstance</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">hinstance</span><span class="p">,</span>
                <span class="n">hwdn</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateWin32SurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">android</span><span class="p">():</span>
            <span class="c1"># TODO</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="s2">&quot;Android not supported for now&quot;</span><span class="p">)</span>

        <span class="n">surface_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_X11</span><span class="p">:</span> <span class="n">xlib</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_MIR</span><span class="p">:</span> <span class="n">mir</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WAYLAND</span><span class="p">:</span> <span class="n">wayland</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WINDOWS</span><span class="p">:</span> <span class="n">windows</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_ANDROID</span><span class="p">:</span> <span class="n">android</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface_mapping</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">subsystem</span><span class="p">]()</span>

    <span class="k">def</span> <span class="nf">_create_physical_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan physical device</span>

<span class="sd">        The best physical device is selected through criteria.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">physical_devices</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">physical_devices</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No physical device found&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">physical_devices</span><span class="p">]</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceProperties</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">physical_devices</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available physical devices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">deviceName</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>

        <span class="c1"># Select best physical device based on properties ans features</span>
        <span class="n">selected_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">physical_devices</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Discrete GPU is better</span>
            <span class="k">if</span> <span class="n">properties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deviceType</span> <span class="o">==</span> \
               <span class="n">vk</span><span class="o">.</span><span class="n">VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1000</span>

            <span class="n">score</span> <span class="o">+=</span> <span class="n">properties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">maxImageDimension2D</span>

            <span class="c1"># Device must contain graphic and present queue family</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_queue_families</span><span class="p">(</span>
                <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">selected_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># No available physical device</span>
        <span class="k">if</span> <span class="n">best_score</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No available physical device&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># The best device is now selected_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span> <span class="o">=</span> <span class="n">physical_devices</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> device selected&quot;</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span><span class="o">.</span><span class="n">deviceName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan logical device</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_device_extensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">)</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>

        <span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_queue_families</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">])</span>

        <span class="n">queues_create</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VkDeviceQueueCreateInfo</span><span class="p">(</span>
                <span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span><span class="p">}]</span>

        <span class="n">device_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDeviceCreateInfo</span><span class="p">(</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">queues_create</span><span class="p">),</span>
            <span class="n">queues_create</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">),</span> <span class="n">layers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">),</span> <span class="n">extensions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">device_create</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetDeviceQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">graphic_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetDeviceQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">present_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graphic&#39;</span><span class="p">:</span> <span class="n">graphic_index</span><span class="p">,</span>
                                     <span class="s1">&#39;present&#39;</span><span class="p">:</span> <span class="n">present_index</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_create_swapchain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan swapchain</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">surface_capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceCapabilitiesKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">surface_formats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceFormatsKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">surface_present_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfacePresentModesKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">surface_formats</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">surface_present_modes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No available swapchain&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_format</span><span class="p">(</span><span class="n">formats</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FORMAT_UNDEFINED</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FORMAT_B8G8R8A8_UNORM</span> <span class="ow">and</span> \
                   <span class="n">f</span><span class="o">.</span><span class="n">colorSpace</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_COLOR_SPACE_SRGB_NONLINEAR_KHR</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span>
            <span class="k">return</span> <span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_present_mode</span><span class="p">(</span><span class="n">present_modes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">present_modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_PRESENT_MODE_MAILBOX_KHR</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">p</span>
            <span class="k">return</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_PRESENT_MODE_FIFO_KHR</span>

        <span class="k">def</span> <span class="nf">get_swap_extent</span><span class="p">(</span><span class="n">capabilities</span><span class="p">):</span>
            <span class="n">uint32_max</span> <span class="o">=</span> <span class="mi">4294967295</span>

            <span class="k">if</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">currentExtent</span><span class="o">.</span><span class="n">width</span> <span class="o">!=</span> <span class="n">uint32_max</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">currentExtent</span>

            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">capabilities</span><span class="o">.</span><span class="n">minImageExtent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">capabilities</span><span class="o">.</span><span class="n">maxImageExtent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>

            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">capabilities</span><span class="o">.</span><span class="n">minImageExtent</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">capabilities</span><span class="o">.</span><span class="n">maxImageExtent</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkExtent2D</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

        <span class="n">surface_format</span> <span class="o">=</span> <span class="n">get_format</span><span class="p">(</span><span class="n">surface_formats</span><span class="p">)</span>
        <span class="n">present_mode</span> <span class="o">=</span> <span class="n">get_present_mode</span><span class="p">(</span><span class="n">surface_present_modes</span><span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">get_swap_extent</span><span class="p">(</span><span class="n">surface_capabilities</span><span class="p">)</span>

        <span class="c1"># Try to create triple buffering</span>
        <span class="n">image_count</span> <span class="o">=</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">minImageCount</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
           <span class="n">image_count</span> <span class="o">&gt;</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span><span class="p">:</span>
            <span class="n">image_count</span> <span class="o">=</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span>

        <span class="n">sharing_mode</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_SHARING_MODE_EXCLUSIVE</span>
        <span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">]</span> <span class="o">!=</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;present&#39;</span><span class="p">]:</span>
            <span class="n">sharing_mode</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_SHARING_MODE_CONCURRENT</span>
            <span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

        <span class="c1"># Finally create swapchain</span>
        <span class="n">swapchain_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSwapchainCreateInfoKHR</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SWAPCHAIN_CREATE_INFO_KHR</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">surface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
            <span class="n">minImageCount</span><span class="o">=</span><span class="n">image_count</span><span class="p">,</span>
            <span class="n">imageFormat</span><span class="o">=</span><span class="n">surface_format</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
            <span class="n">imageColorSpace</span><span class="o">=</span><span class="n">surface_format</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span>
            <span class="n">imageExtent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
            <span class="n">imageArrayLayers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">imageUsage</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_IMAGE_USAGE_TRANSFER_DST_BIT</span><span class="p">,</span>
            <span class="n">imageSharingMode</span><span class="o">=</span><span class="n">sharing_mode</span><span class="p">,</span>
            <span class="n">queueFamilyIndexCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">queue_family_indices</span><span class="p">),</span>
            <span class="n">pQueueFamilyIndices</span><span class="o">=</span><span class="n">queue_family_indices</span><span class="p">,</span>
            <span class="n">compositeAlpha</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_COMPOSITE_ALPHA_OPAQUE_BIT_KHR</span><span class="p">,</span>
            <span class="n">presentMode</span><span class="o">=</span><span class="n">present_mode</span><span class="p">,</span>
            <span class="n">clipped</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_TRUE</span><span class="p">,</span>
            <span class="n">oldSwapchain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">preTransform</span><span class="o">=</span><span class="n">surface_capabilities</span><span class="o">.</span><span class="n">currentTransform</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkCreateSwapchainKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">swapchain_create</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span> <span class="o">=</span> <span class="n">surface_format</span><span class="o">.</span><span class="n">format</span>

        <span class="n">swapchain_raw_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetSwapchainImagesKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw_image</span> <span class="ow">in</span> <span class="n">swapchain_raw_images</span><span class="p">:</span>
            <span class="c1"># Put swapchain image in Image</span>
            <span class="c1"># It&#39;s a bad practice but for this specific use case, it&#39;s good</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
            <span class="n">img</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">raw_image</span>
            <span class="n">img</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">surface_format</span><span class="o">.</span><span class="n">format</span>
            <span class="n">img</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="n">img</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="n">img</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># Update layout of all swapchain images to present khr</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">vo</span><span class="o">.</span><span class="n">immediate_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="n">image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Swapchain created with </span><span class="si">%s</span><span class="s2"> images&quot;</span><span class="p">,</span>
                     <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_create_final_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_SRC</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_DST</span>  <span class="c1"># noqa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">TYPE_2D</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">SampleCount</span><span class="o">.</span><span class="n">COUNT_1</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">SharingMode</span><span class="o">.</span><span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="p">[],</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageTiling</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">DEVICE_LOCAL</span>
        <span class="p">)</span>

        <span class="c1"># Fill image memory and put it into color attachment layout</span>
        <span class="n">clear_color</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ClearColorValue</span><span class="p">(</span><span class="n">float32</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="n">vo</span><span class="o">.</span><span class="n">ImageSubresourceRange</span><span class="p">(</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">with</span> <span class="n">vo</span><span class="o">.</span><span class="n">immediate_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span>
            <span class="p">)</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">clear_color_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">clear_color</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span>
            <span class="p">)</span>

        <span class="c1"># Create image view</span>
        <span class="n">subresource_range</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ImageSubresourceRange</span><span class="p">(</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span>
            <span class="n">base_miplevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">level_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">base_layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">layer_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_image_view</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ImageView</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageViewType</span><span class="o">.</span><span class="n">TYPE_2D</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span><span class="p">),</span> <span class="n">subresource_range</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_commandbuffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create the command buffers used to copy image&#39;&#39;&#39;</span>
        <span class="n">commandpool</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">CommandPool</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="n">commandpool</span><span class="o">.</span><span class="n">allocate_buffers</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferLevel</span><span class="o">.</span><span class="n">PRIMARY</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">commandbuffer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">commandbuffer</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_READ</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_READ</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_semaphores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create semaphores used during image swaping&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan context</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The `VulkWindow`</span>
<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_instance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>

        <span class="c1"># Next functions need extension pointers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_pfn</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_debug_callback</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_surface</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_physical_device</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_device</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_swapchain</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_final_image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_commandbuffers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_semaphores</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">semaphores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Display final image on screen.</span>

<span class="sd">        This function makes all the rendering work. To proceed, it copies the</span>
<span class="sd">        `final_image` into the current swapchain image previously acquired.</span>
<span class="sd">        You can pass custom semaphores (and you should) to synchronize the</span>
<span class="sd">        command.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `semaphore`: A `list` of `Semaphore` to wait on</span>

<span class="sd">        **Note: `final_image` layout is handled by `VulkContext`. You must</span>
<span class="sd">                 let it to COLOR_ATTACHMENT_OPTIMAL**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Acquire image</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkAcquireNextImageKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">,</span> <span class="n">vk</span><span class="o">.</span><span class="n">UINT64_MAX</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="o">.</span><span class="n">semaphore</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">wait_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">semaphores</span><span class="p">:</span>
            <span class="n">wait_semaphores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">semaphores</span><span class="p">)</span>

        <span class="n">wait_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OUTPUT</span><span class="p">]</span>
        <span class="n">wait_masks</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">)</span>

        <span class="n">copied_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span><span class="o">.</span><span class="n">semaphore</span><span class="p">]</span>

        <span class="c1"># Transfer final image to swapchain image</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSubmitInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SUBMIT_INFO</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">),</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">semaphore</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">wait_semaphores</span><span class="p">],</span>
            <span class="n">pWaitDstStageMask</span><span class="o">=</span><span class="n">wait_masks</span><span class="p">,</span>
            <span class="n">commandBufferCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pCommandBuffers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">],</span>
            <span class="n">signalSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
            <span class="n">pSignalSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span>
        <span class="p">)</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueSubmit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">submit</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c1"># Present swapchain image on screen</span>
        <span class="n">present</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPresentInfoKHR</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PRESENT_INFO_KHR</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span><span class="p">,</span>
            <span class="n">swapchainCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pSwapchains</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">],</span>
            <span class="n">pImageIndices</span><span class="o">=</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">pResults</span><span class="o">=</span><span class="bp">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkQueuePresentKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span><span class="p">,</span> <span class="n">present</span><span class="p">)</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkDeviceWaitIdle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="vulk.context.ENGINE_NAME" class="name">var <span class="ident">ENGINE_NAME</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="vulk.context.logger" class="name">var <span class="ident">logger</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="vulk.context.SDL2Error" class="name">class <span class="ident">SDL2Error</span></p>
      
  
    <div class="desc"><p>Common base class for all non-exit exceptions.</p>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.SDL2Error', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.SDL2Error" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SDL2Error</span><span class="p">(</span><span class="n">VulkError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vulk.context.SDL2Error">SDL2Error</a></li>
          <li>vulk.exception.VulkError</li>
          <li>builtins.Exception</li>
          <li>builtins.BaseException</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="vulk.context.SDL2Error.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="vulk.context.VulkContext" class="name">class <span class="ident">VulkContext</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkContext', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkContext" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VulkContext</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Vulkan instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Extension functions in a dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Instance to the debug callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Surface to the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Properties of physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Features of physical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Logical device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Graphic queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Presentation queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Indices of queue families</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain images (vulkanobject.Image type)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Swapchain format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Width of the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Height of the window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Final image which is copied into swapchain image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Image view of the final image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image_view</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Semaphores used during presentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Semaphores used for direct rendering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_semaphores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Command buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_instance_extensions</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get extensions which depend on the window and configuration</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The `VulkWindow`</span>
<span class="sd">        - `configuration`: Configuration from App</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        Extension list</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Get available extensions</span>
        <span class="n">available_extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">extensionName</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateInstanceExtensionProperties</span><span class="p">(</span><span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available instance extensions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">available_extensions</span><span class="p">)</span>

        <span class="c1"># Compute needed extensions</span>
        <span class="n">extension_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_X11</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_XLIB_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WINDOWS</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_WIN32_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WAYLAND</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_WAYLAND_SURFACE_EXTENSION_NAME</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_MIR</span><span class="p">:</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_MIR_SURFACE_EXTENSION_NAME</span>
        <span class="p">}</span>
        <span class="n">sdl_subsystem</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">subsystem</span>

        <span class="k">if</span> <span class="n">sdl_subsystem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extension_mapping</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan not supported on this plateform: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl_subsystem</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Select extension</span>
        <span class="n">enabled_extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_SURFACE_EXTENSION_NAME</span><span class="p">)</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extension_mapping</span><span class="p">[</span><span class="n">sdl_subsystem</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_EXT_DEBUG_REPORT_EXTENSION_NAME</span> <span class="ow">in</span> <span class="n">available_extensions</span><span class="p">:</span>
                <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">vk</span><span class="o">.</span><span class="n">VK_EXT_DEBUG_REPORT_EXTENSION_NAME</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Vulkan debug extension not present and debug&quot;</span>
                               <span class="s2">&quot;mode asked, disabling debug mode&quot;</span><span class="p">)</span>

        <span class="c1"># Check extensions availability</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">e</span> <span class="ow">in</span> <span class="n">available_extensions</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">enabled_extensions</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan extensions are not all available&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enabled_extensions</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_device_extensions</span><span class="p">(</span><span class="n">physical_device</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get device extensions</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `physical_device`: The VkPhysicalDevice to check</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        Extension list</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Get available extensions</span>
        <span class="n">available_extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">extensionName</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span>
                <span class="n">physical_device</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available device extensions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">available_extensions</span><span class="p">)</span>

        <span class="c1"># Select extensions</span>
        <span class="n">enabled_extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">enabled_extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_KHR_SWAPCHAIN_EXTENSION_NAME</span><span class="p">)</span>

        <span class="c1"># Check extensions availability</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">e</span> <span class="ow">in</span> <span class="n">available_extensions</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">enabled_extensions</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Vulkan extensions are not all available&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enabled_extensions</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get all enabled layers</span>

<span class="sd">        Simple algorythm: return everything in debug mode else nothing</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - configuration: configuration from App</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        List of all enabled layers</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">layerName</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span>
                  <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumerateInstanceLayerProperties</span><span class="p">(</span><span class="bp">None</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available layers: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>

        <span class="c1"># Standard validation is a meta layer containing the others</span>
        <span class="n">standard</span> <span class="o">=</span> <span class="s1">&#39;VK_LAYER_LUNARG_standard_validation&#39;</span>
        <span class="k">if</span> <span class="n">standard</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting only </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">standard</span><span class="p">)</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">standard</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">layers</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_queue_families</span><span class="p">(</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">pfn</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get graphic and present queue families</span>

<span class="sd">        Check for graphic and presentation queue families.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `physical_device`: The `VkPhysicalDevice` to check for</span>
<span class="sd">        - `surface`: The `VkSurfaceKHR` to present</span>
<span class="sd">        - `pfn`: Function `vkGetPhysicalDeviceSurfaceSupportKHR` callable</span>

<span class="sd">        *Returns:*</span>

<span class="sd">        A tuple with graphic index and present index or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">queue_families</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">physical_device</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="n">graphic_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">present_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">queue_family</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">queue_families</span><span class="p">):</span>
            <span class="c1"># Queue family needs queues</span>
            <span class="k">if</span> <span class="n">queue_family</span><span class="o">.</span><span class="n">queueCount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check that queue family support present queue</span>
            <span class="n">present_available</span> <span class="o">=</span> <span class="n">pfn</span><span class="p">(</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">surface</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">queue_family</span><span class="o">.</span><span class="n">queueFlags</span> <span class="o">&amp;</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_QUEUE_GRAPHICS_BIT</span><span class="p">:</span>
                <span class="n">graphic_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">present_available</span><span class="p">:</span>
                <span class="n">present_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">if</span> <span class="n">graphic_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">present_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span>

    <span class="k">def</span> <span class="nf">_get_pfn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get extension function pointers</span>

<span class="sd">        Get only functions used in `VulkContext`, vulkan instance must exist</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;_create_instance must be called before _get_pfn&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_pfn</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetInstanceProcAddr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t get address of </span><span class="si">%s</span><span class="s2"> extension function&quot;</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">extension_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vkDestroySurfaceKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceCapabilitiesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfaceFormatsKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetPhysicalDeviceSurfacePresentModesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkCreateSwapchainKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkGetSwapchainImagesKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkAcquireNextImageKHR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkQueuePresentKHR&#39;</span>
        <span class="p">}</span>

        <span class="n">debug_extension_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vkCreateDebugReportCallbackEXT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vkDestroyDebugReportCallbackEXT&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">extension_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">debug_extension_functions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">extension_functions</span><span class="p">:</span>
            <span class="n">add_pfn</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan instance</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The window for Vulkan</span>
<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">extensions</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_instance_extensions</span><span class="p">(</span><span class="n">window</span><span class="p">,</span>
                                                          <span class="n">configuration</span><span class="p">)</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>

        <span class="n">app_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkApplicationInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">,</span>
            <span class="n">pApplicationName</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">applicationVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">pEngineName</span><span class="o">=</span><span class="n">ENGINE_NAME</span><span class="p">,</span>
            <span class="n">engineVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">apiVersion</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_API_VERSION_1_0</span><span class="p">)</span>

        <span class="n">instance_create_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkInstanceCreateInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">pApplicationInfo</span><span class="o">=</span><span class="n">app_info</span><span class="p">,</span>
            <span class="n">enabledExtensionCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">),</span>
            <span class="n">ppEnabledExtensionNames</span><span class="o">=</span><span class="n">extensions</span><span class="p">,</span>
            <span class="n">enabledLayerCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">),</span>
            <span class="n">ppEnabledLayerNames</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="n">pCreateInfo</span><span class="o">=</span><span class="n">instance_create_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_debug_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create debug callback</span>

<span class="sd">        It works only on debug mode</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">vulkan_debug_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_DEBUG_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_WARNING_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_ERROR_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_INFORMATION_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_PERFORMANCE_WARNING_BIT_EXT</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">debug_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vulkan_debug_mapping</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s2">&quot;VULKAN: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_ERROR_BIT_EXT</span> <span class="o">|</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_WARNING_BIT_EXT</span> <span class="o">|</span>
                 <span class="c1"># vk.VK_DEBUG_REPORT_INFORMATION_BIT_EXT |</span>
                 <span class="c1"># vk.VK_DEBUG_REPORT_DEBUG_BIT_EXT |</span>
                 <span class="n">vk</span><span class="o">.</span><span class="n">VK_DEBUG_REPORT_PERFORMANCE_WARNING_BIT_EXT</span><span class="p">)</span>

        <span class="n">debug_create_info</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDebugReportCallbackCreateInfoEXT</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEBUG_REPORT_CALLBACK_CREATE_INFO_EXT</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
            <span class="n">pfnCallback</span><span class="o">=</span><span class="n">debug_function</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkCreateDebugReportCallbackEXT&#39;</span><span class="p">](</span>
            <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
            <span class="n">pCreateInfo</span><span class="o">=</span><span class="n">debug_create_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan surface</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `info`: The window information for Vulkan</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">call_platform</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetInstanceProcAddr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">pCreateInfo</span><span class="o">=</span><span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">xlib</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create XLIB surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkXlibSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_XLIB_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">dpy</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">x11</span><span class="o">.</span><span class="n">display</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">x11</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateXlibSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mir</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create MIR surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkMirSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_MIR_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">connection</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">mir</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">mirSurface</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">mir</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateMirSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">wayland</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create WAYLAND surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkWaylandSurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_WAYLAND_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">display</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">display</span><span class="p">,</span>
                <span class="n">surface</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateWaylandSurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">windows</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create WINDOWS surface&quot;</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">surface_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkWin32SurfaceCreateInfoKHR</span><span class="p">(</span>
                <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_WAYLAND_SURFACE_CREATE_INFO_KHR</span><span class="p">,</span>
                <span class="n">hinstance</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">hinstance</span><span class="p">,</span>
                <span class="n">hwdn</span><span class="o">=</span><span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_platform</span><span class="p">(</span><span class="s1">&#39;vkCreateWin32SurfaceKHR&#39;</span><span class="p">,</span> <span class="n">surface_create</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">android</span><span class="p">():</span>
            <span class="c1"># TODO</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="s2">&quot;Android not supported for now&quot;</span><span class="p">)</span>

        <span class="n">surface_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_X11</span><span class="p">:</span> <span class="n">xlib</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_MIR</span><span class="p">:</span> <span class="n">mir</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WAYLAND</span><span class="p">:</span> <span class="n">wayland</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_WINDOWS</span><span class="p">:</span> <span class="n">windows</span><span class="p">,</span>
            <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SYSWM_ANDROID</span><span class="p">:</span> <span class="n">android</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface_mapping</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">subsystem</span><span class="p">]()</span>

    <span class="k">def</span> <span class="nf">_create_physical_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan physical device</span>

<span class="sd">        The best physical device is selected through criteria.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">physical_devices</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">physical_devices</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No physical device found&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceFeatures</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">physical_devices</span><span class="p">]</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">vk</span><span class="o">.</span><span class="n">vkGetPhysicalDeviceProperties</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">physical_devices</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Available physical devices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">deviceName</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>

        <span class="c1"># Select best physical device based on properties ans features</span>
        <span class="n">selected_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">physical_devices</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Discrete GPU is better</span>
            <span class="k">if</span> <span class="n">properties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deviceType</span> <span class="o">==</span> \
               <span class="n">vk</span><span class="o">.</span><span class="n">VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1000</span>

            <span class="n">score</span> <span class="o">+=</span> <span class="n">properties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">maxImageDimension2D</span>

            <span class="c1"># Device must contain graphic and present queue family</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_queue_families</span><span class="p">(</span>
                <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">selected_index</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># No available physical device</span>
        <span class="k">if</span> <span class="n">best_score</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No available physical device&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># The best device is now selected_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span> <span class="o">=</span> <span class="n">physical_devices</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">selected_index</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> device selected&quot;</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span><span class="o">.</span><span class="n">deviceName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan logical device</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_device_extensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">)</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_layers</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>

        <span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span> <span class="o">=</span> <span class="n">VulkContext</span><span class="o">.</span><span class="n">_get_queue_families</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceSupportKHR&#39;</span><span class="p">])</span>

        <span class="n">queues_create</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VkDeviceQueueCreateInfo</span><span class="p">(</span>
                <span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">{</span><span class="n">graphic_index</span><span class="p">,</span> <span class="n">present_index</span><span class="p">}]</span>

        <span class="n">device_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkDeviceCreateInfo</span><span class="p">(</span>
            <span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">queues_create</span><span class="p">),</span>
            <span class="n">queues_create</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">),</span> <span class="n">layers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">),</span> <span class="n">extensions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkCreateDevice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="n">device_create</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetDeviceQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">graphic_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">vkGetDeviceQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">present_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graphic&#39;</span><span class="p">:</span> <span class="n">graphic_index</span><span class="p">,</span>
                                     <span class="s1">&#39;present&#39;</span><span class="p">:</span> <span class="n">present_index</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_create_swapchain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan swapchain</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">surface_capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceCapabilitiesKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">surface_formats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfaceFormatsKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">surface_present_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetPhysicalDeviceSurfacePresentModesKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">surface_formats</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">surface_present_modes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No available swapchain&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VulkError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_format</span><span class="p">(</span><span class="n">formats</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FORMAT_UNDEFINED</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_FORMAT_B8G8R8A8_UNORM</span> <span class="ow">and</span> \
                   <span class="n">f</span><span class="o">.</span><span class="n">colorSpace</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_COLOR_SPACE_SRGB_NONLINEAR_KHR</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span>
            <span class="k">return</span> <span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_present_mode</span><span class="p">(</span><span class="n">present_modes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">present_modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_PRESENT_MODE_MAILBOX_KHR</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">p</span>
            <span class="k">return</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_PRESENT_MODE_FIFO_KHR</span>

        <span class="k">def</span> <span class="nf">get_swap_extent</span><span class="p">(</span><span class="n">capabilities</span><span class="p">):</span>
            <span class="n">uint32_max</span> <span class="o">=</span> <span class="mi">4294967295</span>

            <span class="k">if</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">currentExtent</span><span class="o">.</span><span class="n">width</span> <span class="o">!=</span> <span class="n">uint32_max</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">currentExtent</span>

            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">capabilities</span><span class="o">.</span><span class="n">minImageExtent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">capabilities</span><span class="o">.</span><span class="n">maxImageExtent</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>

            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">capabilities</span><span class="o">.</span><span class="n">minImageExtent</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">capabilities</span><span class="o">.</span><span class="n">maxImageExtent</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkExtent2D</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

        <span class="n">surface_format</span> <span class="o">=</span> <span class="n">get_format</span><span class="p">(</span><span class="n">surface_formats</span><span class="p">)</span>
        <span class="n">present_mode</span> <span class="o">=</span> <span class="n">get_present_mode</span><span class="p">(</span><span class="n">surface_present_modes</span><span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">get_swap_extent</span><span class="p">(</span><span class="n">surface_capabilities</span><span class="p">)</span>

        <span class="c1"># Try to create triple buffering</span>
        <span class="n">image_count</span> <span class="o">=</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">minImageCount</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
           <span class="n">image_count</span> <span class="o">&gt;</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span><span class="p">:</span>
            <span class="n">image_count</span> <span class="o">=</span> <span class="n">surface_capabilities</span><span class="o">.</span><span class="n">maxImageCount</span>

        <span class="n">sharing_mode</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_SHARING_MODE_EXCLUSIVE</span>
        <span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">]</span> <span class="o">!=</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;present&#39;</span><span class="p">]:</span>
            <span class="n">sharing_mode</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VK_SHARING_MODE_CONCURRENT</span>
            <span class="n">queue_family_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

        <span class="c1"># Finally create swapchain</span>
        <span class="n">swapchain_create</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSwapchainCreateInfoKHR</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SWAPCHAIN_CREATE_INFO_KHR</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">surface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span>
            <span class="n">minImageCount</span><span class="o">=</span><span class="n">image_count</span><span class="p">,</span>
            <span class="n">imageFormat</span><span class="o">=</span><span class="n">surface_format</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
            <span class="n">imageColorSpace</span><span class="o">=</span><span class="n">surface_format</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span>
            <span class="n">imageExtent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
            <span class="n">imageArrayLayers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">imageUsage</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_IMAGE_USAGE_TRANSFER_DST_BIT</span><span class="p">,</span>
            <span class="n">imageSharingMode</span><span class="o">=</span><span class="n">sharing_mode</span><span class="p">,</span>
            <span class="n">queueFamilyIndexCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">queue_family_indices</span><span class="p">),</span>
            <span class="n">pQueueFamilyIndices</span><span class="o">=</span><span class="n">queue_family_indices</span><span class="p">,</span>
            <span class="n">compositeAlpha</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_COMPOSITE_ALPHA_OPAQUE_BIT_KHR</span><span class="p">,</span>
            <span class="n">presentMode</span><span class="o">=</span><span class="n">present_mode</span><span class="p">,</span>
            <span class="n">clipped</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_TRUE</span><span class="p">,</span>
            <span class="n">oldSwapchain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">preTransform</span><span class="o">=</span><span class="n">surface_capabilities</span><span class="o">.</span><span class="n">currentTransform</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkCreateSwapchainKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">swapchain_create</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span> <span class="o">=</span> <span class="n">surface_format</span><span class="o">.</span><span class="n">format</span>

        <span class="n">swapchain_raw_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkGetSwapchainImagesKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw_image</span> <span class="ow">in</span> <span class="n">swapchain_raw_images</span><span class="p">:</span>
            <span class="c1"># Put swapchain image in Image</span>
            <span class="c1"># It&#39;s a bad practice but for this specific use case, it&#39;s good</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
            <span class="n">img</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">raw_image</span>
            <span class="n">img</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">surface_format</span><span class="o">.</span><span class="n">format</span>
            <span class="n">img</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="n">img</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="n">img</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># Update layout of all swapchain images to present khr</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">vo</span><span class="o">.</span><span class="n">immediate_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="n">image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Swapchain created with </span><span class="si">%s</span><span class="s2"> images&quot;</span><span class="p">,</span>
                     <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_create_final_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_SRC</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT</span> <span class="o">|</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageUsage</span><span class="o">.</span><span class="n">TRANSFER_DST</span>  <span class="c1"># noqa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageType</span><span class="o">.</span><span class="n">TYPE_2D</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">SampleCount</span><span class="o">.</span><span class="n">COUNT_1</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">SharingMode</span><span class="o">.</span><span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="p">[],</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageTiling</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">MemoryProperty</span><span class="o">.</span><span class="n">DEVICE_LOCAL</span>
        <span class="p">)</span>

        <span class="c1"># Fill image memory and put it into color attachment layout</span>
        <span class="n">clear_color</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ClearColorValue</span><span class="p">(</span><span class="n">float32</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="n">vo</span><span class="o">.</span><span class="n">ImageSubresourceRange</span><span class="p">(</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">with</span> <span class="n">vo</span><span class="o">.</span><span class="n">immediate_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span>
            <span class="p">)</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">clear_color_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">clear_color</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span>
            <span class="p">)</span>

        <span class="c1"># Create image view</span>
        <span class="n">subresource_range</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ImageSubresourceRange</span><span class="p">(</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">ImageAspect</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span>
            <span class="n">base_miplevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">level_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">base_layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">layer_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_image_view</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">ImageView</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageViewType</span><span class="o">.</span><span class="n">TYPE_2D</span><span class="p">,</span>
            <span class="n">vc</span><span class="o">.</span><span class="n">Format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span><span class="p">),</span> <span class="n">subresource_range</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_commandbuffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create the command buffers used to copy image&#39;&#39;&#39;</span>
        <span class="n">commandpool</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">CommandPool</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span><span class="p">[</span><span class="s1">&#39;graphic&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="n">commandpool</span><span class="o">.</span><span class="n">allocate_buffers</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">CommandBufferLevel</span><span class="o">.</span><span class="n">PRIMARY</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">commandbuffer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">commandbuffer</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span> <span class="k">as</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_READ</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">TOP_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_DST_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">PRESENT_SRC_KHR</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_WRITE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">MEMORY_READ</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">TRANSFER_SRC_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">ImageLayout</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OPTIMAL</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">BOTTOM_OF_PIPE</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">TRANSFER_READ</span><span class="p">,</span>
                    <span class="n">vc</span><span class="o">.</span><span class="n">Access</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_WRITE</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_semaphores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create semaphores used during image swaping&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span> <span class="o">=</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">vo</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create Vulkan context</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `window`: The `VulkWindow`</span>
<span class="sd">        - `configuration`: Configuration from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_instance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>

        <span class="c1"># Next functions need extension pointers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_pfn</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_debug_callback</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_surface</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_physical_device</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_device</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_swapchain</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_final_image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_commandbuffers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_semaphores</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">semaphores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Display final image on screen.</span>

<span class="sd">        This function makes all the rendering work. To proceed, it copies the</span>
<span class="sd">        `final_image` into the current swapchain image previously acquired.</span>
<span class="sd">        You can pass custom semaphores (and you should) to synchronize the</span>
<span class="sd">        command.</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `semaphore`: A `list` of `Semaphore` to wait on</span>

<span class="sd">        **Note: `final_image` layout is handled by `VulkContext`. You must</span>
<span class="sd">                 let it to COLOR_ATTACHMENT_OPTIMAL**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Acquire image</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkAcquireNextImageKHR&#39;</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">,</span> <span class="n">vk</span><span class="o">.</span><span class="n">UINT64_MAX</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="o">.</span><span class="n">semaphore</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">wait_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">semaphores</span><span class="p">:</span>
            <span class="n">wait_semaphores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">semaphores</span><span class="p">)</span>

        <span class="n">wait_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OUTPUT</span><span class="p">]</span>
        <span class="n">wait_masks</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">)</span>

        <span class="n">copied_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span><span class="o">.</span><span class="n">semaphore</span><span class="p">]</span>

        <span class="c1"># Transfer final image to swapchain image</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSubmitInfo</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SUBMIT_INFO</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">),</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">semaphore</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">wait_semaphores</span><span class="p">],</span>
            <span class="n">pWaitDstStageMask</span><span class="o">=</span><span class="n">wait_masks</span><span class="p">,</span>
            <span class="n">commandBufferCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pCommandBuffers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">],</span>
            <span class="n">signalSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
            <span class="n">pSignalSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span>
        <span class="p">)</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueSubmit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">submit</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c1"># Present swapchain image on screen</span>
        <span class="n">present</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPresentInfoKHR</span><span class="p">(</span>
            <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PRESENT_INFO_KHR</span><span class="p">,</span>
            <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
            <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span><span class="p">,</span>
            <span class="n">swapchainCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">pSwapchains</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">],</span>
            <span class="n">pImageIndices</span><span class="o">=</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">pResults</span><span class="o">=</span><span class="bp">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkQueuePresentKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span><span class="p">,</span> <span class="n">present</span><span class="p">)</span>

        <span class="n">vk</span><span class="o">.</span><span class="n">vkDeviceWaitIdle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vulk.context.VulkContext">VulkContext</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkContext.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkContext.__init__', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkContext.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Vulkan instance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Extension functions in a dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Instance to the debug callback</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Surface to the window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Physical device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">physical_device</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Properties of physical device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_properties</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Features of physical device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">physical_device_features</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Logical device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Graphic queue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Presentation queue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Indices of queue families</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue_family_indices</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Swapchain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Swapchain images (vulkanobject.Image type)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_images</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Swapchain format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">swapchain_format</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Width of the window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Height of the window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Final image which is copied into swapchain image</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">final_image</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Image view of the final image</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">final_image_view</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Semaphores used during presentation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Semaphores used for direct rendering</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_direct_semaphores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Command buffers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkContext.create">
    <p>def <span class="ident">create</span>(</p><p>self, window, configuration)</p>
    </div>
    

    
  
    <div class="desc"><p>Create Vulkan context</p>

<p><em>Parameters:</em></p>

<ul>
<li><code>window</code>: The <code>VulkWindow</code></li>
<li><code>configuration</code>: Configuration from Application</li>
</ul>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkContext.create', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkContext.create" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create Vulkan context</span>
<span class="sd">    *Parameters:*</span>
<span class="sd">    - `window`: The `VulkWindow`</span>
<span class="sd">    - `configuration`: Configuration from Application</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_instance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>
    <span class="c1"># Next functions need extension pointers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_pfn</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_debug_callback</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_surface</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_physical_device</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_device</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_swapchain</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_final_image</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_commandbuffers</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_semaphores</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkContext.swap">
    <p>def <span class="ident">swap</span>(</p><p>self, semaphores=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Display final image on screen.</p>

<p>This function makes all the rendering work. To proceed, it copies the
<code>final_image</code> into the current swapchain image previously acquired.
You can pass custom semaphores (and you should) to synchronize the
command.</p>

<p><em>Parameters:</em></p>

<ul>
<li><code>semaphore</code>: A <code>list</code> of <code>Semaphore</code> to wait on</li>
</ul>

<p><strong>Note: <code>final_image</code> layout is handled by <code>VulkContext</code>. You must
         let it to COLOR<em>ATTACHMENT</em>OPTIMAL</strong></p>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkContext.swap', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkContext.swap" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">semaphores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Display final image on screen.</span>
<span class="sd">    This function makes all the rendering work. To proceed, it copies the</span>
<span class="sd">    `final_image` into the current swapchain image previously acquired.</span>
<span class="sd">    You can pass custom semaphores (and you should) to synchronize the</span>
<span class="sd">    command.</span>
<span class="sd">    *Parameters:*</span>
<span class="sd">    - `semaphore`: A `list` of `Semaphore` to wait on</span>
<span class="sd">    **Note: `final_image` layout is handled by `VulkContext`. You must</span>
<span class="sd">             let it to COLOR_ATTACHMENT_OPTIMAL**</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Acquire image</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkAcquireNextImageKHR&#39;</span><span class="p">](</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">,</span> <span class="n">vk</span><span class="o">.</span><span class="n">UINT64_MAX</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="o">.</span><span class="n">semaphore</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">wait_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_available</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">semaphores</span><span class="p">:</span>
        <span class="n">wait_semaphores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">semaphores</span><span class="p">)</span>
    <span class="n">wait_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">vc</span><span class="o">.</span><span class="n">PipelineStage</span><span class="o">.</span><span class="n">COLOR_ATTACHMENT_OUTPUT</span><span class="p">]</span>
    <span class="n">wait_masks</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">)</span>
    <span class="n">copied_semaphores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_semaphore_copied</span><span class="o">.</span><span class="n">semaphore</span><span class="p">]</span>
    <span class="c1"># Transfer final image to swapchain image</span>
    <span class="n">submit</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkSubmitInfo</span><span class="p">(</span>
        <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_SUBMIT_INFO</span><span class="p">,</span>
        <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wait_semaphores</span><span class="p">),</span>
        <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">semaphore</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">wait_semaphores</span><span class="p">],</span>
        <span class="n">pWaitDstStageMask</span><span class="o">=</span><span class="n">wait_masks</span><span class="p">,</span>
        <span class="n">commandBufferCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">pCommandBuffers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">commandbuffers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">commandbuffer</span><span class="p">],</span>
        <span class="n">signalSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
        <span class="n">pSignalSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span>
    <span class="p">)</span>
    <span class="n">vk</span><span class="o">.</span><span class="n">vkQueueSubmit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphic_queue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">submit</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
    <span class="c1"># Present swapchain image on screen</span>
    <span class="n">present</span> <span class="o">=</span> <span class="n">vk</span><span class="o">.</span><span class="n">VkPresentInfoKHR</span><span class="p">(</span>
        <span class="n">sType</span><span class="o">=</span><span class="n">vk</span><span class="o">.</span><span class="n">VK_STRUCTURE_TYPE_PRESENT_INFO_KHR</span><span class="p">,</span>
        <span class="n">waitSemaphoreCount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">copied_semaphores</span><span class="p">),</span>
        <span class="n">pWaitSemaphores</span><span class="o">=</span><span class="n">copied_semaphores</span><span class="p">,</span>
        <span class="n">swapchainCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">pSwapchains</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swapchain</span><span class="p">],</span>
        <span class="n">pImageIndices</span><span class="o">=</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
        <span class="n">pResults</span><span class="o">=</span><span class="bp">None</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pfn</span><span class="p">[</span><span class="s1">&#39;vkQueuePresentKHR&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">present_queue</span><span class="p">,</span> <span class="n">present</span><span class="p">)</span>
    <span class="n">vk</span><span class="o">.</span><span class="n">vkDeviceWaitIdle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="vulk.context.VulkContext.commandbuffers" class="name">var <span class="ident">commandbuffers</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.debug_callback" class="name">var <span class="ident">debug_callback</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.device" class="name">var <span class="ident">device</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.final_image" class="name">var <span class="ident">final_image</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.final_image_view" class="name">var <span class="ident">final_image_view</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.graphic_queue" class="name">var <span class="ident">graphic_queue</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.height" class="name">var <span class="ident">height</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.instance" class="name">var <span class="ident">instance</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.pfn" class="name">var <span class="ident">pfn</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.physical_device" class="name">var <span class="ident">physical_device</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.physical_device_features" class="name">var <span class="ident">physical_device_features</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.physical_device_properties" class="name">var <span class="ident">physical_device_properties</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.present_queue" class="name">var <span class="ident">present_queue</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.queue_family_indices" class="name">var <span class="ident">queue_family_indices</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.surface" class="name">var <span class="ident">surface</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.swapchain" class="name">var <span class="ident">swapchain</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.swapchain_format" class="name">var <span class="ident">swapchain_format</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.swapchain_images" class="name">var <span class="ident">swapchain_images</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkContext.width" class="name">var <span class="ident">width</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="vulk.context.VulkWindow" class="name">class <span class="ident">VulkWindow</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkWindow', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkWindow" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VulkWindow</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Open the SDL2 Window</span>

<span class="sd">        *Parameters:*</span>

<span class="sd">        - `configuration`: Configurations parameters from Application</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Init</span><span class="p">(</span><span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_INIT_VIDEO</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span> <span class="ow">and</span> \
           <span class="n">configuration</span><span class="o">.</span><span class="n">width</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN</span>
        <span class="k">elif</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN_DESKTOP</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">decorated</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_BORDERLESS</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">resizable</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_RESIZABLE</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">highdpi</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_ALLOW_HIGHDPI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_CreateWindow</span><span class="p">(</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">configuration</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window opened with configuration: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="p">(</span><span class="n">configuration</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SysWMinfo</span><span class="p">()</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_VERSION</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetWindowWMInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window closed&quot;</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_DestroyWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Quit</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vulk.context.VulkWindow">VulkWindow</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkWindow.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkWindow.__init__', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkWindow.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkWindow.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkWindow.close', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkWindow.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window closed&quot;</span><span class="p">)</span>
    <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_DestroyWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
    <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Quit</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vulk.context.VulkWindow.open">
    <p>def <span class="ident">open</span>(</p><p>self, configuration)</p>
    </div>
    

    
  
    <div class="desc"><p>Open the SDL2 Window</p>

<p><em>Parameters:</em></p>

<ul>
<li><code>configuration</code>: Configurations parameters from Application</li>
</ul>
</div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vulk.context.VulkWindow.open', this);">Show source &equiv;</a></p>
  <div id="source-vulk.context.VulkWindow.open" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Open the SDL2 Window</span>
<span class="sd">    *Parameters:*</span>
<span class="sd">    - `configuration`: Configurations parameters from Application</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_Init</span><span class="p">(</span><span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_INIT_VIDEO</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span> <span class="ow">and</span> \
       <span class="n">configuration</span><span class="o">.</span><span class="n">width</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN</span>
    <span class="k">elif</span> <span class="n">configuration</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_FULLSCREEN_DESKTOP</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">decorated</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_BORDERLESS</span>
    <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">resizable</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_RESIZABLE</span>
    <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">highdpi</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_WINDOW_ALLOW_HIGHDPI</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_CreateWindow</span><span class="p">(</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">configuration</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">configuration</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can&#39;t open window: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetError</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SDL2Error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SDL2 window opened with configuration: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                 <span class="p">(</span><span class="n">configuration</span><span class="p">,))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_SysWMinfo</span><span class="p">()</span>
    <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_VERSION</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="n">sdl2</span><span class="o">.</span><span class="n">SDL_GetWindowWMInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="vulk.context.VulkWindow.info" class="name">var <span class="ident">info</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vulk.context.VulkWindow.window" class="name">var <span class="ident">window</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

  </footer>
</div>

<script type="text/javascript">
    var em = document.querySelectorAll("em");
    var underline = ["Parameters:", "Returns:", "Exemple:"];

    for (var i = 0; i < em.length; ++i) {
        var item = em[i];
        for (var j = 0; j < underline.length; j++) {
            var search = underline[j];
            if (item.textContent == search) {
                item.style.textDecorationLine = "underline";
            }
        }
    }
</script>

</body>
</html>
